


ALTER TABLE dbo.MOUVEMENT_STOCK ADD
	TAILLE_MS_ID numeric(18, 0) NULL,
	NOM_TAILLE_MS nvarchar(50) NULL,
	COULEUR_MS_ID numeric(18, 0) NULL,
	NOM_COULEUR_MS nvarchar(50) NULL
GO
---------------------------------------------------------------------------------

CREATE TABLE [dbo].[TAILLE](
	[ID_TAILLE] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[SOCIETE_ID] [numeric](18, 0) NOT NULL,
	[NOM_TAILLE] [nvarchar](50) NOT NULL,
	[ORDRE_TAILLE] [numeric](18, 0) NULL,
	[BLOQUE_TAILLE] [bit] NOT NULL,
	[USER_CREATION_ID] [numeric](18, 0) NOT NULL,
	[DATE_CREATION] [datetime] NOT NULL,
	[USER_MODIF_ID] [numeric](18, 0) NULL,
	[DATE_MODIF] [datetime] NULL,
 CONSTRAINT [PK_TAILLE] PRIMARY KEY CLUSTERED 
(
	[ID_TAILLE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[TAILLE] ADD  CONSTRAINT [DF_TAILLE_BLOQUE_MARQUE_ARTICLE]  DEFAULT ((0)) FOR [BLOQUE_TAILLE]
GO

ALTER TABLE [dbo].[TAILLE] ADD  CONSTRAINT [DF_TAILLE_DATE_CREATION]  DEFAULT (getdate()) FOR [DATE_CREATION]
GO

ALTER TABLE [dbo].[TAILLE]  WITH CHECK ADD  CONSTRAINT [FK_TAILLE_SOCIETE] FOREIGN KEY([SOCIETE_ID])
REFERENCES [dbo].[SOCIETE] ([ID_SOCIETE])
GO

ALTER TABLE [dbo].[TAILLE] CHECK CONSTRAINT [FK_TAILLE_SOCIETE]
GO




-------------------------------------------------------------------------


CREATE TABLE [dbo].[COULEUR](
	[ID_COULEUR] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[SOCIETE_ID] [numeric](18, 0) NOT NULL,
	[NOM_COULEUR] [nvarchar](50) NOT NULL,
	[BLOQUE_COULEUR] [bit] NOT NULL,
	[USER_CREATION_ID] [numeric](18, 0) NOT NULL,
	[DATE_CREATION] [datetime] NOT NULL,
	[USER_MODIF_ID] [numeric](18, 0) NULL,
	[DATE_MODIF] [datetime] NULL,
 CONSTRAINT [PK_COULEUR] PRIMARY KEY CLUSTERED 
(
	[ID_COULEUR] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[COULEUR] ADD  CONSTRAINT [DF_COULEUR_BLOQUE_TAILLE]  DEFAULT ((0)) FOR [BLOQUE_COULEUR]
GO

ALTER TABLE [dbo].[COULEUR] ADD  CONSTRAINT [DF_COULEUR_DATE_CREATION]  DEFAULT (getdate()) FOR [DATE_CREATION]
GO

ALTER TABLE [dbo].[COULEUR]  WITH CHECK ADD  CONSTRAINT [FK_COULEUR_SOCIETE] FOREIGN KEY([SOCIETE_ID])
REFERENCES [dbo].[SOCIETE] ([ID_SOCIETE])
GO

ALTER TABLE [dbo].[COULEUR] CHECK CONSTRAINT [FK_COULEUR_SOCIETE]
GO




------------------------------------------------------------------------------


--CREATE TABLE [dbo].[ARTICLE_TAILLE](
--	[ID_ARTICLE_TAILLE] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
--	[ARTICLE_ID] [numeric](18, 0) NOT NULL,
--	[TAILLE_ID] [numeric](18, 0) NOT NULL,
--	[ORDRE_ARTICLE_TAILLE] [int] NULL,
-- CONSTRAINT [PK_ARTICLE_TAILLE] PRIMARY KEY CLUSTERED 
--(
--	[ID_ARTICLE_TAILLE] ASC
--)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
--) ON [PRIMARY]
--GO

--ALTER TABLE [dbo].[ARTICLE_TAILLE]  WITH CHECK ADD  CONSTRAINT [FK_ARTICLE_TAILLE_ARTICLE] FOREIGN KEY([ARTICLE_ID])
--REFERENCES [dbo].[ARTICLE] ([ID_ARTICLE])
--GO

--ALTER TABLE [dbo].[ARTICLE_TAILLE] CHECK CONSTRAINT [FK_ARTICLE_TAILLE_ARTICLE]
--GO

--ALTER TABLE [dbo].[ARTICLE_TAILLE]  WITH CHECK ADD  CONSTRAINT [FK_ARTICLE_TAILLE_TAILLE] FOREIGN KEY([TAILLE_ID])
--REFERENCES [dbo].[TAILLE] ([ID_TAILLE])
--GO

--ALTER TABLE [dbo].[ARTICLE_TAILLE] CHECK CONSTRAINT [FK_ARTICLE_TAILLE_TAILLE]
--GO

------------------------------------------------------------------------------

--CREATE TABLE [dbo].[ARTICLE_COULEUR](
--	[ID_ARTICLE_COULEUR] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
--	[ARTICLE_ID] [numeric](18, 0) NOT NULL,
--	[COULEUR_ID] [numeric](18, 0) NOT NULL,
-- CONSTRAINT [PK_ARTICLE_COULEUR] PRIMARY KEY CLUSTERED 
--(
--	[ID_ARTICLE_COULEUR] ASC
--)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
--) ON [PRIMARY]
--GO

--ALTER TABLE [dbo].[ARTICLE_COULEUR]  WITH CHECK ADD  CONSTRAINT [FK_ARTICLE_COULEUR_ARTICLE] FOREIGN KEY([ARTICLE_ID])
--REFERENCES [dbo].[ARTICLE] ([ID_ARTICLE])
--GO

--ALTER TABLE [dbo].[ARTICLE_COULEUR] CHECK CONSTRAINT [FK_ARTICLE_COULEUR_ARTICLE]
--GO

--ALTER TABLE [dbo].[ARTICLE_COULEUR]  WITH CHECK ADD  CONSTRAINT [FK_ARTICLE_COULEUR_COULEUR] FOREIGN KEY([COULEUR_ID])
--REFERENCES [dbo].[COULEUR] ([ID_COULEUR])
--GO

--ALTER TABLE [dbo].[ARTICLE_COULEUR] CHECK CONSTRAINT [FK_ARTICLE_COULEUR_COULEUR]
--GO


-----------------------------------------------------------------------------------

CREATE TABLE [dbo].[ARTICLE_PROPRIETE](
	[ID_PROPRIETE] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[ARTICLE_ID] [numeric](18, 0) NOT NULL,
	[TAILLE_ID] [numeric](18, 0) NULL,
	[COULEUR_ID] [numeric](18, 0) NULL,
	[CODE_BARRE_PROPRIETE] [varchar](50) NULL,
	[BLOQUE_PROPRIETE] [bit] NOT NULL,
 CONSTRAINT [PK_ARTICLE_TAILLE_COULEUR] PRIMARY KEY CLUSTERED 
(
	[ID_PROPRIETE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[ARTICLE_PROPRIETE] ADD  CONSTRAINT [DF_ARTICLE_PROPRIETE_BLOQUE_PROPRIETE]  DEFAULT ((0)) FOR [BLOQUE_PROPRIETE]
GO

ALTER TABLE [dbo].[ARTICLE_PROPRIETE]  WITH CHECK ADD  CONSTRAINT [FK_ARTICLE_TAILLE_COULEUR_ARTICLE] FOREIGN KEY([ARTICLE_ID])
REFERENCES [dbo].[ARTICLE] ([ID_ARTICLE])
GO

ALTER TABLE [dbo].[ARTICLE_PROPRIETE] CHECK CONSTRAINT [FK_ARTICLE_TAILLE_COULEUR_ARTICLE]
GO

ALTER TABLE [dbo].[ARTICLE_PROPRIETE]  WITH CHECK ADD  CONSTRAINT [FK_ARTICLE_TAILLE_COULEUR_ARTICLE_COULEUR] FOREIGN KEY([COULEUR_ID])
REFERENCES [dbo].[COULEUR] ([ID_COULEUR])
GO

ALTER TABLE [dbo].[ARTICLE_PROPRIETE] CHECK CONSTRAINT [FK_ARTICLE_TAILLE_COULEUR_ARTICLE_COULEUR]
GO

ALTER TABLE [dbo].[ARTICLE_PROPRIETE]  WITH CHECK ADD  CONSTRAINT [FK_ARTICLE_TAILLE_COULEUR_ARTICLE_TAILLE] FOREIGN KEY([TAILLE_ID])
REFERENCES [dbo].[TAILLE] ([ID_TAILLE])
GO

ALTER TABLE [dbo].[ARTICLE_PROPRIETE] CHECK CONSTRAINT [FK_ARTICLE_TAILLE_COULEUR_ARTICLE_TAILLE]
GO


----------------------------------------------------------------------------------


ALTER TABLE dbo.AVOIR_CLIENT_LIGNE ADD
TAILLE_AC_L_ID numeric(18, 0) NULL,
NOM_TAILLE_AC_L nvarchar(50) NULL,
COULEUR_AC_L_ID numeric(18, 0) NULL,
NOM_COULEUR_AC_L nvarchar(50) NULL
GO
ALTER TABLE dbo.AVOIR_CLIENT_LIGNE ADD CONSTRAINT
FK_AVOIR_CLIENT_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_AC_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.AVOIR_CLIENT_LIGNE ADD CONSTRAINT
FK_AVOIR_CLIENT_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_AC_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO

-----------------------------------------------------------------------

ALTER TABLE dbo.AVOIR_FOURNISSEUR_LIGNE ADD
TAILLE_AF_L_ID numeric(18, 0) NULL,
NOM_TAILLE_AF_L nvarchar(50) NULL,
COULEUR_AF_L_ID numeric(18, 0) NULL,
NOM_COULEUR_AF_L nvarchar(50) NULL
GO
ALTER TABLE dbo.AVOIR_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_AVOIR_FOURNSSEUR_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_AF_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.AVOIR_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_AVOIR_FOURNISSEUR_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_AF_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO

--------------------------------------------------------------------------

ALTER TABLE dbo.BON_COMMANDE_CLIENT_LIGNE ADD
TAILLE_BCC_L_ID numeric(18, 0) NULL,
NOM_TAILLE_BCC_L nvarchar(50) NULL,
COULEUR_BCC_L_ID numeric(18, 0) NULL,
NOM_COULEUR_BCC_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_COMMANDE_CLIENT_LIGNE ADD CONSTRAINT
FK_BON_COMMANDE_CLIENT_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_BCC_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_COMMANDE_CLIENT_LIGNE ADD CONSTRAINT
FK_BON_COMMANDE_CLIENT_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_BCC_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.BON_COMMANDE_FOURNISSEUR_LIGNE ADD
TAILLE_BCF_L_ID numeric(18, 0) NULL,
NOM_TAILLE_BCF_L nvarchar(50) NULL,
COULEUR_BCF_L_ID numeric(18, 0) NULL,
NOM_COULEUR_BCF_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_COMMANDE_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_BON_COMMANDE_FOURNISSEUR_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_BCF_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_COMMANDE_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_BON_COMMANDE_FOURNISSEUR_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_BCF_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO

--------------------------------------------------------------------------

ALTER TABLE dbo.BON_ENTREE_STOCK_LIGNE ADD
TAILLE_ES_L_ID numeric(18, 0) NULL,
NOM_TAILLE_ES_L nvarchar(50) NULL,
COULEUR_ES_L_ID numeric(18, 0) NULL,
NOM_COULEUR_ES_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_ENTREE_STOCK_LIGNE ADD CONSTRAINT
FK_BON_ENTREE_STOCK_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_ES_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_ENTREE_STOCK_LIGNE ADD CONSTRAINT
FK_BON_ENTREE_STOCK_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_ES_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.BON_SORTIE_STOCK_LIGNE ADD
TAILLE_SS_L_ID numeric(18, 0) NULL,
NOM_TAILLE_SS_L nvarchar(50) NULL,
COULEUR_SS_L_ID numeric(18, 0) NULL,
NOM_COULEUR_SS_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_SORTIE_STOCK_LIGNE ADD CONSTRAINT
FK_BON_SORTIE_STOCK_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_SS_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_SORTIE_STOCK_LIGNE ADD CONSTRAINT
FK_BON_SORTIE_STOCK_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_SS_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.BON_LIVRAISON_CLIENT_LIGNE ADD
TAILLE_BLC_L_ID numeric(18, 0) NULL,
NOM_TAILLE_BLC_L nvarchar(50) NULL,
COULEUR_BLC_L_ID numeric(18, 0) NULL,
NOM_COULEUR_BLC_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_LIVRAISON_CLIENT_LIGNE ADD CONSTRAINT
FK_BON_LIVRAISON_CLIENT_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_BLC_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_LIVRAISON_CLIENT_LIGNE ADD CONSTRAINT
FK_BON_LIVRAISON_CLIENT_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_BLC_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.BON_RECEPTION_FOURNISSEUR_LIGNE ADD
TAILLE_BRF_L_ID numeric(18, 0) NULL,
NOM_TAILLE_BRF_L nvarchar(50) NULL,
COULEUR_BRF_L_ID numeric(18, 0) NULL,
NOM_COULEUR_BRF_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_RECEPTION_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_BON_RECEPTION_FOURNISSEUR_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_BRF_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_RECEPTION_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_BON_RECEPTION_FOURNISSEUR_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_BRF_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.BON_RETOUR_CLIENT_LIGNE ADD
TAILLE_BRC_L_ID numeric(18, 0) NULL,
NOM_TAILLE_BRC_L nvarchar(50) NULL,
COULEUR_BRC_L_ID numeric(18, 0) NULL,
NOM_COULEUR_BRC_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_RETOUR_CLIENT_LIGNE ADD CONSTRAINT
FK_BON_RETOUR_CLIENT_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_BRC_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_RETOUR_CLIENT_LIGNE ADD CONSTRAINT
FK_BON_RETOUR_CLIENT_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_BRC_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.BON_RETOUR_FOURNISSEUR_LIGNE ADD
TAILLE_BTF_L_ID numeric(18, 0) NULL,
NOM_TAILLE_BTF_L nvarchar(50) NULL,
COULEUR_BTF_L_ID numeric(18, 0) NULL,
NOM_COULEUR_BTF_L nvarchar(50) NULL
GO
ALTER TABLE dbo.BON_RETOUR_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_BON_RETOUR_FOURNISSEUR_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_BTF_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.BON_RETOUR_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_BON_RETOUR_FOURNISSEUR_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_BTF_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO




--------------------------------------------------------------------------

ALTER TABLE dbo.DEVIS_CLIENT_LIGNE ADD
TAILLE_DC_L_ID numeric(18, 0) NULL,
NOM_TAILLE_DC_L nvarchar(50) NULL,
COULEUR_DC_L_ID numeric(18, 0) NULL,
NOM_COULEUR_DC_L nvarchar(50) NULL
GO
ALTER TABLE dbo.DEVIS_CLIENT_LIGNE ADD CONSTRAINT
FK_DEVIS_CLIENT_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_DC_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.DEVIS_CLIENT_LIGNE ADD CONSTRAINT
FK_DEVIS_CLIENT_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_DC_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.FACTURE_CLIENT_LIGNE ADD
TAILLE_FCC_L_ID numeric(18, 0) NULL,
NOM_TAILLE_FCC_L nvarchar(50) NULL,
COULEUR_FCC_L_ID numeric(18, 0) NULL,
NOM_COULEUR_FCC_L nvarchar(50) NULL
GO
ALTER TABLE dbo.FACTURE_CLIENT_LIGNE ADD CONSTRAINT
FK_FACTURE_CLIENT_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_FCC_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.FACTURE_CLIENT_LIGNE ADD CONSTRAINT
FK_FACTURE_CLIENT_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_FCC_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


--------------------------------------------------------------------------

ALTER TABLE dbo.FACTURE_FOURNISSEUR_LIGNE ADD
TAILLE_FCF_L_ID numeric(18, 0) NULL,
NOM_TAILLE_FCF_L nvarchar(50) NULL,
COULEUR_FCF_L_ID numeric(18, 0) NULL,
NOM_COULEUR_FCF_L nvarchar(50) NULL
GO
ALTER TABLE dbo.FACTURE_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_FACTURE_FOURNISSEUR_LIGNE_TAILLE FOREIGN KEY
(
TAILLE_FCF_L_ID
) REFERENCES dbo.TAILLE
(
ID_TAILLE
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO
ALTER TABLE dbo.FACTURE_FOURNISSEUR_LIGNE ADD CONSTRAINT
FK_FACTURE_FOURNISSEUR_LIGNE_COULEUR FOREIGN KEY
(
COULEUR_FCF_L_ID
) REFERENCES dbo.COULEUR
(
ID_COULEUR
) ON UPDATE  NO ACTION 
 ON DELETE  NO ACTION 

GO


---------------------------------------------------------------

ALTER VIEW [dbo].[VUE_AVOIR_CLIENT_LIGNE]
AS
SELECT        dbo.AVOIR_CLIENT_LIGNE.*, dbo.AVOIR_CLIENT.NUMERO_AC
FROM            dbo.AVOIR_CLIENT_LIGNE INNER JOIN
                         dbo.AVOIR_CLIENT ON dbo.AVOIR_CLIENT_LIGNE.AC_ID = dbo.AVOIR_CLIENT.ID_AC
GO

ALTER VIEW [dbo].[VUE_AVOIR_FOURNISSEUR_LIGNE]
AS
SELECT        dbo.AVOIR_FOURNISSEUR_LIGNE.*, dbo.AVOIR_FOURNISSEUR.NUMERO_AF
FROM            dbo.AVOIR_FOURNISSEUR_LIGNE INNER JOIN
                         dbo.AVOIR_FOURNISSEUR ON dbo.AVOIR_FOURNISSEUR_LIGNE.AF_ID = dbo.AVOIR_FOURNISSEUR.ID_AF
GO



ALTER VIEW [dbo].[VUE_BON_COMMANDE_CLIENT_LIGNE]
AS
SELECT        dbo.BON_COMMANDE_CLIENT_LIGNE.*, dbo.BON_COMMANDE_CLIENT.NUMERO_BCC
FROM            dbo.BON_COMMANDE_CLIENT_LIGNE INNER JOIN
                         dbo.BON_COMMANDE_CLIENT ON dbo.BON_COMMANDE_CLIENT_LIGNE.BCC_ID = dbo.BON_COMMANDE_CLIENT.ID_BCC
GO

ALTER VIEW [dbo].[VUE_BON_COMMANDE_FOURNISSEUR_LIGNE]
AS
SELECT        dbo.BON_COMMANDE_FOURNISSEUR_LIGNE.*, dbo.BON_COMMANDE_FOURNISSEUR.NUMERO_BCF
FROM            dbo.BON_COMMANDE_FOURNISSEUR_LIGNE INNER JOIN
                         dbo.BON_COMMANDE_FOURNISSEUR ON dbo.BON_COMMANDE_FOURNISSEUR_LIGNE.BCF_ID = dbo.BON_COMMANDE_FOURNISSEUR.ID_BCF
GO

ALTER VIEW [dbo].[VUE_BON_LIVRAISON_CLIENT_LIGNE]
AS
SELECT        dbo.BON_LIVRAISON_CLIENT_LIGNE.*, dbo.BON_LIVRAISON_CLIENT.NUMERO_BLC
FROM            dbo.BON_LIVRAISON_CLIENT_LIGNE INNER JOIN
                         dbo.BON_LIVRAISON_CLIENT ON dbo.BON_LIVRAISON_CLIENT_LIGNE.BLC_ID = dbo.BON_LIVRAISON_CLIENT.ID_BLC
GO

ALTER VIEW [dbo].[VUE_BON_RECEPTION_FOURNISSEUR_LIGNE]
AS
SELECT         dbo.BON_RECEPTION_FOURNISSEUR_LIGNE.*, dbo.BON_RECEPTION_FOURNISSEUR.NUMERO_BRF
FROM            dbo.BON_RECEPTION_FOURNISSEUR_LIGNE INNER JOIN
                         dbo.BON_RECEPTION_FOURNISSEUR ON dbo.BON_RECEPTION_FOURNISSEUR_LIGNE.BRF_ID = dbo.BON_RECEPTION_FOURNISSEUR.ID_BRF
GO

ALTER VIEW [dbo].[VUE_BON_RETOUR_CLIENT_LIGNE]
AS
SELECT        dbo.BON_RETOUR_CLIENT_LIGNE.*, dbo.BON_RETOUR_CLIENT.NUMERO_BRC
FROM            dbo.BON_RETOUR_CLIENT_LIGNE INNER JOIN
                         dbo.BON_RETOUR_CLIENT ON dbo.BON_RETOUR_CLIENT_LIGNE.BRC_ID = dbo.BON_RETOUR_CLIENT.ID_BRC
GO

ALTER VIEW [dbo].[VUE_BON_RETOUR_FOURNISSEUR_LIGNE]
AS
SELECT        dbo.BON_RETOUR_FOURNISSEUR_LIGNE.*, dbo.BON_RETOUR_FOURNISSEUR.NUMERO_BTF
FROM            dbo.BON_RETOUR_FOURNISSEUR_LIGNE INNER JOIN
                         dbo.BON_RETOUR_FOURNISSEUR ON dbo.BON_RETOUR_FOURNISSEUR_LIGNE.BTF_ID = dbo.BON_RETOUR_FOURNISSEUR.ID_BTF
GO



ALTER VIEW [dbo].[VUE_DEVIS_CLIENT_LIGNE]
AS
SELECT        dbo.DEVIS_CLIENT_LIGNE.*, dbo.DEVIS_CLIENT.NUMERO_DC
FROM            dbo.DEVIS_CLIENT_LIGNE INNER JOIN
                         dbo.DEVIS_CLIENT ON dbo.DEVIS_CLIENT_LIGNE.DC_ID = dbo.DEVIS_CLIENT.ID_DC
GO

ALTER VIEW [dbo].[VUE_FACTURE_CLIENT_LIGNE]
AS
SELECT        dbo.FACTURE_CLIENT_LIGNE.*, dbo.FACTURE_CLIENT.NUMERO_FCC
FROM            dbo.FACTURE_CLIENT_LIGNE INNER JOIN
                         dbo.FACTURE_CLIENT ON dbo.FACTURE_CLIENT_LIGNE.FCC_ID = dbo.FACTURE_CLIENT.ID_FCC
GO



ALTER VIEW [dbo].[VUE_FACTURE_FOURNISSEUR_LIGNE]
AS
SELECT        dbo.FACTURE_FOURNISSEUR_LIGNE.*, dbo.FACTURE_FOURNISSEUR.NUMERO_FCF
FROM            dbo.FACTURE_FOURNISSEUR_LIGNE INNER JOIN
                         dbo.FACTURE_FOURNISSEUR ON dbo.FACTURE_FOURNISSEUR_LIGNE.FCF_ID = dbo.FACTURE_FOURNISSEUR.ID_FCF
GO

---------------------------------------------------------------------------------

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1708,'33','TAILLE_AC_L_ID','TAILLE_AC_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1709,'33','NOM_TAILLE_AC_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1710,'33','COULEUR_AC_L_ID','COULEUR_AC_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1711,'33','NOM_COULEUR_AC_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1712,'74','TAILLE_AF_L_ID','TAILLE_AF_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1713,'74','NOM_TAILLE_AF_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1714,'74','COULEUR_AF_L_ID','COULEUR_AF_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1715,'74','NOM_COULEUR_AF_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1716,'2','TAILLE_BCC_L_ID','TAILLE_BCC_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1717,'2','NOM_TAILLE_BCC_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1718,'2','COULEUR_BCC_L_ID','COULEUR_BCC_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1719,'2','NOM_COULEUR_BCC_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1720,'61','TAILLE_BCF_L_ID','TAILLE_BCF_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1721,'61','NOM_TAILLE_BCF_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1722,'61','COULEUR_BCF_L_ID','COULEUR_BCF_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1723,'61','NOM_COULEUR_BCF_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1724,'20','TAILLE_BLC_L_ID','TAILLE_BLC_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1725,'20','NOM_TAILLE_BLC_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1726,'20','COULEUR_BLC_L_ID','COULEUR_BLC_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1727,'20','NOM_COULEUR_BLC_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1728,'66','TAILLE_BRF_L_ID','TAILLE_BRF_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1729,'66','NOM_TAILLE_BRF_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1730,'66','COULEUR_BRF_L_ID','COULEUR_BRF_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1731,'66','NOM_COULEUR_BRF_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1732,'25','TAILLE_BRC_L_ID','TAILLE_BRC_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1733,'25','NOM_TAILLE_BRC_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1734,'25','COULEUR_BRC_L_ID','COULEUR_BRC_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1735,'25','NOM_COULEUR_BRC_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1736,'78','TAILLE_BTF_L_ID','TAILLE_BTF_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1737,'78','NOM_TAILLE_BTF_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1738,'78','COULEUR_BTF_L_ID','COULEUR_BTF_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1739,'78','NOM_COULEUR_BTF_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1740,'85','TAILLE_SS_L_ID','TAILLE_SS_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1741,'85','NOM_TAILLE_SS_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1742,'85','COULEUR_SS_L_ID','COULEUR_SS_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1743,'85','NOM_COULEUR_SS_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1744,'82','TAILLE_ES_L_ID','TAILLE_ES_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1745,'82','NOM_TAILLE_ES_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1746,'82','COULEUR_ES_L_ID','COULEUR_ES_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1747,'82','NOM_COULEUR_ES_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1748,'1','TAILLE_DC_L_ID','TAILLE_DC_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1749,'1','NOM_TAILLE_DC_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1750,'1','COULEUR_DC_L_ID','COULEUR_DC_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1751,'1','NOM_COULEUR_DC_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1752,'29','TAILLE_FCC_L_ID','TAILLE_FCC_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1753,'29','NOM_TAILLE_FCC_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1754,'29','COULEUR_FCC_L_ID','COULEUR_FCC_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1755,'29','NOM_COULEUR_FCC_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1756,'70','TAILLE_FCF_L_ID','TAILLE_FCF_L_ID',NULL,NULL,'0',NULL,'20','1','0','1','0','0','0','0','0','1','0','40','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1757,'70','NOM_TAILLE_FCF_L','TAILLE',NULL,NULL,'50',NULL,'50','1','1','1','0','1','0','0','0','1','0','41','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1758,'70','COULEUR_FCF_L_ID','COULEUR_FCF_L_ID',NULL,NULL,'50',NULL,'20','1','0','1','0','0','0','0','0','1','0','42','NUMERIC','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1759,'70','NOM_COULEUR_FCF_L','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','1','0','0','0','1','0','43','TEXT','C')

GO
----------------------------------------------------------------------------------------------

--create procedure PRC_LISTE_TAILLE_ARTICLE 
--@ID_ARTICLE numeric(18,0)
--as

--select TAILLE.ID_TAILLE,TAILLE.NOM_TAILLE from ARTICLE_TAILLE 
--inner join TAILLE on TAILLE.ID_TAILLE=ARTICLE_TAILLE.TAILLE_ID
--where ARTICLE_ID=@ID_ARTICLE
--GO

-----------------------------------------------------------------------------------------------

--create procedure PRC_LISTE_COULEUR_ARTICLE
--@ID_ARTICLE numeric(18,0)
--as

--select COULEUR.ID_COULEUR,COULEUR.NOM_COULEUR from ARTICLE_COULEUR 
--inner join COULEUR on COULEUR.ID_COULEUR=ARTICLE_COULEUR.COULEUR_ID
--where ARTICLE_ID=@ID_ARTICLE
--GO

-----------------------------------------------------------------------------


CREATE TABLE [dbo].[STOCK_PROPRIETE](
	[ID_PROPRIETE] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[SOCIETE_ID] [numeric](18, 0) NOT NULL,
	[ARTICLE_PROPRIETE_ID] [numeric](18, 0) NOT NULL,
	[TAILLE_PROPRIETE_ID] [numeric](18, 0) NULL,
	[COULEUR_PROPRIETE_ID] [numeric](18, 0) NULL,
	[DEPOT_PROPRIETE_ID] [numeric](18, 0) NOT NULL,
	[QUANTITE_STOCK_PROPRIETE] [decimal](18, 5) NOT NULL,
 CONSTRAINT [PK_STOCK_PROPRIETE] PRIMARY KEY CLUSTERED 
(
	[ID_PROPRIETE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE]  WITH CHECK ADD  CONSTRAINT [FK_STOCK_PROPRIETE_COULEUR] FOREIGN KEY([COULEUR_PROPRIETE_ID])
REFERENCES [dbo].[COULEUR] ([ID_COULEUR])
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE] CHECK CONSTRAINT [FK_STOCK_PROPRIETE_COULEUR]
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE]  WITH CHECK ADD  CONSTRAINT [FK_STOCK_PROPRIETE_SOCIETE] FOREIGN KEY([SOCIETE_ID])
REFERENCES [dbo].[SOCIETE] ([ID_SOCIETE])
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE] CHECK CONSTRAINT [FK_STOCK_PROPRIETE_SOCIETE]
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE]  WITH CHECK ADD  CONSTRAINT [FK_STOCK_PROPRIETE_STOCK_ARTICLE] FOREIGN KEY([ARTICLE_PROPRIETE_ID])
REFERENCES [dbo].[ARTICLE] ([ID_ARTICLE])
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE] CHECK CONSTRAINT [FK_STOCK_PROPRIETE_STOCK_ARTICLE]
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE]  WITH CHECK ADD  CONSTRAINT [FK_STOCK_PROPRIETE_TAILLE] FOREIGN KEY([TAILLE_PROPRIETE_ID])
REFERENCES [dbo].[TAILLE] ([ID_TAILLE])
GO

ALTER TABLE [dbo].[STOCK_PROPRIETE] CHECK CONSTRAINT [FK_STOCK_PROPRIETE_TAILLE]
GO


-------------------------------------------------------------------------

insert GRID  (ID_GRID,NOM_GRID,CONDITION_PARTICULIERE_GRID,CONDITION_SOCIETE_GRID,TABLE_GRID,KEY_ID_GRID) 
values (189,'TAILLE',NULL,'1','TAILLE','ID_TAILLE')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values (1760,'189','ID_TAILLE','ID_TAILLE',NULL,NULL,'0',NULL,'20','1','0','1','0','0','1','0','0','0','0','1','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1761,'189','NOM_TAILLE','TAILLE',NULL,NULL,'100',NULL,'50','1','1','0','0','0','0','0','0','0','0','2','TEXT','C')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1762,'189','ORDRE_TAILLE','ORDRE',NULL,NULL,'100',NULL,'3','1','1','0','0','0','0','0','0','0','0','3','NUMERIC','R')

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1763,'189','BLOQUE_TAILLE','BLOQUE',NULL,NULL,'75',NULL,'1','1','1','0','0','0','0','0','0','0','1','4','BIT','C')

insert GRID  (ID_GRID,NOM_GRID,CONDITION_PARTICULIERE_GRID,CONDITION_SOCIETE_GRID,TABLE_GRID,KEY_ID_GRID)
values (190,'COULEUR',NULL,'1','COULEUR','ID_COULEUR')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1764,'190','ID_COULEUR','ID_COULEUR',NULL,NULL,'0',NULL,'20','1','0','0','0','0','1','0','0','0','0','1','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1765,'190','NOM_COULEUR','COULEUR',NULL,NULL,'100',NULL,'50','1','1','0','0','0','0','0','0','0','0','2','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) 
values (1766,'190','BLOQUE_COULEUR','BLOQUE',NULL,NULL,'75',NULL,'1','1','1','0','0','0','0','0','0','0','0','3','BIT','C')
GO
-------------------------------------------------------------------------
insert TYPE_DOCUMENT(
       [ID_TD]
      ,[ABBREVIATION_TD]
      ,[PREFIX_TD]
      ,[NOM_TD]
      ,[TABLE_TD]
      ,[TABLE_UPDATE_TD]
      ,[TABLE_TD_ID]
      ,[TABLE_TD_CHAMPS_ID]
      ,[TABLE_LIGNE_TD]
      ,[TABLE_LIGNE_UPDATE_TD]
      ,[MAX_DOCUMENT_TD]
      ,[MAX_DOCUMENT_GLOBAL_TD]
      ,[EXIST_ANNEE_TD]
      ,[IS_STOCK_TD]
      ,[IS_REGLEMENT_TD]
      ,[MAJ_STOCK_TD]
      ,[TIERS_TD]
      ,[TYPE_MOUVEMENT_TD]
      ,[SOLDE_TIERS_TD]
      ,[ANNULER_STOCK]
      ,[ANNULER_SOLDE]
      ,[IS_DEVISE]
      ,[IS_REMBOURSEMENT]
      ,[VA_TD]
      ,[STATUT_NUMERO_SERIE_TD]
      ,[STATUT_ANNULE_NUMERO_SERIE_TD]
      ,[TYPE_VA_TD]
      ,[CONTROL_LIGNE_VIDE]
      ,[PAMP_TD]
      ,[NUMERO_SERIE_TD]
      ,[MAJ_PRIX_ARTICLE_TD]
      ,[MULTI_TRANSFERT_TD]
      ,[TIERS_REGLEMENT_TD]
      ,[DOCUMENT_STOCK_TD]
      ,[STOCK_BRF]
      ,[BENEFICE_TD])
select 60,'TAILLE',NULL,'TAILLE','TAILLE','TAILLE','ID_TAILLE',NULL,NULL,NULL,0,0,0,0,0,NULL,NULL,NULL,NULL,NULL,NULL,0,0,NULL,NULL,NULL,NULL,NULL,0,0,0,1,NULL,0,NULL,0

insert TYPE_DOCUMENT(
       [ID_TD]
      ,[ABBREVIATION_TD]
      ,[PREFIX_TD]
      ,[NOM_TD]
      ,[TABLE_TD]
      ,[TABLE_UPDATE_TD]
      ,[TABLE_TD_ID]
      ,[TABLE_TD_CHAMPS_ID]
      ,[TABLE_LIGNE_TD]
      ,[TABLE_LIGNE_UPDATE_TD]
      ,[MAX_DOCUMENT_TD]
      ,[MAX_DOCUMENT_GLOBAL_TD]
      ,[EXIST_ANNEE_TD]
      ,[IS_STOCK_TD]
      ,[IS_REGLEMENT_TD]
      ,[MAJ_STOCK_TD]
      ,[TIERS_TD]
      ,[TYPE_MOUVEMENT_TD]
      ,[SOLDE_TIERS_TD]
      ,[ANNULER_STOCK]
      ,[ANNULER_SOLDE]
      ,[IS_DEVISE]
      ,[IS_REMBOURSEMENT]
      ,[VA_TD]
      ,[STATUT_NUMERO_SERIE_TD]
      ,[STATUT_ANNULE_NUMERO_SERIE_TD]
      ,[TYPE_VA_TD]
      ,[CONTROL_LIGNE_VIDE]
      ,[PAMP_TD]
      ,[NUMERO_SERIE_TD]
      ,[MAJ_PRIX_ARTICLE_TD]
      ,[MULTI_TRANSFERT_TD]
      ,[TIERS_REGLEMENT_TD]
      ,[DOCUMENT_STOCK_TD]
      ,[STOCK_BRF]
      ,[BENEFICE_TD])
select 61,'COULEUR',NULL,'COULEUR','COULEUR','COULEUR','ID_COULEUR',NULL,NULL,NULL,0,0,0,0,0,NULL,NULL,NULL,NULL,NULL,NULL,0,0,NULL,NULL,NULL,NULL,NULL,0,0,0,1,NULL,0,NULL,0

insert [PAGE]
(
       [ID_PAGE]
      ,[NOM_PAGE]
      ,[TYPE_PAGE]
      ,[TD_ID]
      ,[GRID_PAGE_ID]
      ,[GRID_PAGE_RECHERCHER_ID]
      ,[GRID_PAGE_LISTER_ID]
      ,[GRID_LISTE_BASE_TVA]
      ,[DUPLIQUER]
      ,[DUPLIQUER_LIGNE]
      ,[EXIST_CLIENT]
      ,[EXIST_FOURNISSEUR]
      ,[EXIST_STATUT]
      ,[EXIST_DEVISE]
      ,[IS_STOCK]
      ,[IS_REGLEMENT]
      ,[GRID_LOAD]
      ,[ACTIF_PAGE]
      ,[B_AJOUTER]
      ,[B_MODIFIER]
      ,[B_SUPPRIMER]
      ,[B_RECHERCHER]
      ,[B_ACTUALISER]
      ,[B_PREMIER]
      ,[B_DERNIER]
      ,[B_SUIVANT]
      ,[B_PRECEDENT]
      ,[B_LISTER]
      ,[B_IMPRIMER]
      ,[B_VALIDER]
      ,[B_ANNULER]
      ,[B_DUPLIQUER]
      ,[B_TRANSFERER_COMMANDE]
      ,[B_TRANSFERER_BON_LIVRAISON]
      ,[B_TRANSFERER_FACTURE]
      ,[B_TRANSFERER_AVOIR]
      ,[B_TRANSFERER_BON_RECEPTION]
      ,[B_TRANSFERT]
      ,[B_BASE_TVA]
      ,[B_REGLEMENT]
      ,[B_CLIENT]
      ,[B_FOURNISSEUR]
      ,[B_INFORMATION]
      ,[B_SOLDER]
      ,[B_REMBOURSEMENT]
      ,[B_DEVALIDER]
      ,[B_REMPLACER]
)
select 84,'TAILLE','P',NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

insert [PAGE]
(
       [ID_PAGE]
      ,[NOM_PAGE]
      ,[TYPE_PAGE]
      ,[TD_ID]
      ,[GRID_PAGE_ID]
      ,[GRID_PAGE_RECHERCHER_ID]
      ,[GRID_PAGE_LISTER_ID]
      ,[GRID_LISTE_BASE_TVA]
      ,[DUPLIQUER]
      ,[DUPLIQUER_LIGNE]
      ,[EXIST_CLIENT]
      ,[EXIST_FOURNISSEUR]
      ,[EXIST_STATUT]
      ,[EXIST_DEVISE]
      ,[IS_STOCK]
      ,[IS_REGLEMENT]
      ,[GRID_LOAD]
      ,[ACTIF_PAGE]
      ,[B_AJOUTER]
      ,[B_MODIFIER]
      ,[B_SUPPRIMER]
      ,[B_RECHERCHER]
      ,[B_ACTUALISER]
      ,[B_PREMIER]
      ,[B_DERNIER]
      ,[B_SUIVANT]
      ,[B_PRECEDENT]
      ,[B_LISTER]
      ,[B_IMPRIMER]
      ,[B_VALIDER]
      ,[B_ANNULER]
      ,[B_DUPLIQUER]
      ,[B_TRANSFERER_COMMANDE]
      ,[B_TRANSFERER_BON_LIVRAISON]
      ,[B_TRANSFERER_FACTURE]
      ,[B_TRANSFERER_AVOIR]
      ,[B_TRANSFERER_BON_RECEPTION]
      ,[B_TRANSFERT]
      ,[B_BASE_TVA]
      ,[B_REGLEMENT]
      ,[B_CLIENT]
      ,[B_FOURNISSEUR]
      ,[B_INFORMATION]
      ,[B_SOLDER]
      ,[B_REMBOURSEMENT]
      ,[B_DEVALIDER]
      ,[B_REMPLACER]
)
select 85,'COULEUR','P',NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0


insert MENU
(
       [ID_MENU]
      ,[NOM_MENU]
      ,[PARENT_ID]
      ,[PAGE_ID]
	  )
select 91,'TAILLE ARTICLE',26,84

insert MENU
(
       [ID_MENU]
      ,[NOM_MENU]
      ,[PARENT_ID]
      ,[PAGE_ID]
	  )
select 92,'COULEUR ARTICLE',26,85

GO
-------------------------------------------------------------------------

ALTER PROCEDURE [dbo].[PRC_VALIDER_DOCUMENT] 
@ID_TYPE_DOCUMENT numeric(18,0),
@ID_DOCUMENT numeric(18,0),
@ID_USER numeric(18,0),
@ID_SOCIETE numeric(18,0),
@ENVOI_RESULTAT bit=1,
@TRANSACT bit=1,
@RESULTAT int=NULL output,
@NUMERO_DOCUMENT varchar(50)=NULL output
AS
BEGIN
declare @sql nvarchar(max)
declare @n int
declare @STATUT varchar(20)
declare @TABLE_DOCUMENT varchar(100)
declare @TABLE_DOCUMENT_UPDATE varchar(100)
declare @TABLE_DOCUMENT_LIGNE varchar(100)
declare @ABBREV_DOCUMENT varchar(10)

declare @N_NULL int
declare @MONTANT_TTC decimal(18,3)
declare @QUANTITE decimal(18,5)
declare @MONTANT_REG decimal(18,3)
declare @IS_STOCK bit
declare @IS_REGLEMENT bit
declare @MAJ_STOCK char(1)
declare @NOM varchar(50)
declare @NUMERO varchar(50)
declare @TIERS varchar(50)
declare @TYPE_MOUVEMENT char(1)
declare @SOLDE_TIERS char(1)
declare @ID_TIERS numeric(18,0)
declare @NOM_TIERS varchar(100)
declare @DEBIT decimal(18,5)
declare @CREDIT decimal(18,5)
declare @DATE_DOCUMENT date
declare @SOLDE_COMMERCIAL_CLIENT decimal(18,3)
declare @SOLDE_COMMERCIAL_CLIENT_AUTORISE decimal(18,3)
declare @NET_PAYER decimal(18,3)
declare @ID_DEVISE_SOCIETE numeric(18,0)
declare @ID_DEVISE numeric(18,0)
declare @DEVISE varchar(50)
declare @LIBELLE_MOUVEMENT_REGLEMENT varchar(200)
declare @IS_DEVISE bit
declare @STOCK_NEGATIF bit
declare @NBRE_ARTICLE int
declare @PAMP bit
declare @MAJ_PRIX_ARTICLE_TD bit
declare @MAJ_PRIX_ARTICLE_SOCIETE bit
declare @TYPE_VA varchar(10)
declare @DOCUMENT_TIERS varchar(50)
declare @DOCUMENT_STOCK_TD bit 
declare @DOCUMENT_STOCK bit 
declare @STATUT_NS varchar(50)
declare @STOCK_BRF bit
declare @STOCK_BRF_SOCIETE bit
declare @MONTANT_HT_NET_FCF decimal(18,5)
declare @NOMBRE_DECIMAL int
declare @MONTANT_GP decimal(18,5)

--INVENTAIRE
if @ID_TYPE_DOCUMENT=31 
	Begin
		EXEC [PRC_VALIDER_INVENTAIRE] @ID_TYPE_DOCUMENT,@ID_DOCUMENT,@ID_USER,@ID_SOCIETE
		Return
	End


select @TABLE_DOCUMENT=TABLE_TD,@TABLE_DOCUMENT_LIGNE=TABLE_LIGNE_TD,@ABBREV_DOCUMENT=ABBREVIATION_TD,
@IS_STOCK=IS_STOCK_TD,@IS_REGLEMENT=IS_REGLEMENT_TD,@MAJ_STOCK=MAJ_STOCK_TD,@NOM=NOM_TD,@TIERS=TIERS_TD,
@TYPE_MOUVEMENT=TYPE_MOUVEMENT_TD,@SOLDE_TIERS=SOLDE_TIERS_TD,@IS_DEVISE=IS_DEVISE,@PAMP=PAMP_TD,
@MAJ_PRIX_ARTICLE_TD=MAJ_PRIX_ARTICLE_TD,@TYPE_VA=TYPE_VA_TD,@DOCUMENT_STOCK_TD=DOCUMENT_STOCK_TD,
@TABLE_DOCUMENT_UPDATE=TABLE_UPDATE_TD,@STATUT_NS=STATUT_NUMERO_SERIE_TD,@STOCK_BRF=STOCK_BRF
from TYPE_DOCUMENT where ID_TD=@ID_TYPE_DOCUMENT


--GESTION PROJET
if @ID_TYPE_DOCUMENT=58
	Begin

	set @sql='select @STATUT=STATUT_'+@ABBREV_DOCUMENT+',@MONTANT_GP=MONTANT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
				execute sp_executesql @sql,N'@STATUT varchar(20) output,@MONTANT_GP decimal(18,3) output',@STATUT output,@MONTANT_GP output

				if @STATUT='ENCOURS'
				begin
				set @sql='update '+@TABLE_DOCUMENT_UPDATE+' set STATUT_'+@ABBREV_DOCUMENT+'=''VALIDE'''+
						',DATE_VALIDATION_'+@ABBREV_DOCUMENT+'=getdate()'+
						' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))

				set @sql=@sql+';select @n=@@ROWCOUNT'
				execute sp_executesql @sql,N'@n int output',@n output
				select @N
				end
		
		Return
	End

if @IS_DEVISE=1 
	Begin
		set @sql='select @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+',@ID_DEVISE=DEVISE_'+@ABBREV_DOCUMENT+'_ID,'
		+'@DOCUMENT_TIERS=DOCUMENT_'+@TIERS+'_'+@ABBREV_DOCUMENT 
		+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
		execute sp_executesql @sql,N'@NUMERO varchar(50) output,@ID_DEVISE numeric(18,0) output,@DOCUMENT_TIERS varchar(50) output',
		@NUMERO output,@ID_DEVISE output,@DOCUMENT_TIERS output
		select @DEVISE=LIBELLE_DEVISE from VUE_DEVISE where ID_DEVISE=@ID_DEVISE
	End
Else
	Begin
		if @TIERS is NOT NULL
			Begin
				set @sql='select @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+',@DOCUMENT_TIERS=DOCUMENT_'+@TIERS+'_'+@ABBREV_DOCUMENT
				+'  from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
				execute sp_executesql @sql,N'@NUMERO varchar(50) output,@DOCUMENT_TIERS varchar(50) output',@NUMERO output,@DOCUMENT_TIERS output
			End
		else
			Begin
				set @sql='select @NUMERO=NUMERO_'+@ABBREV_DOCUMENT
				+'  from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
				execute sp_executesql @sql,N'@NUMERO varchar(50) output',@NUMERO output
			End
	End

if @TRANSACT=1 BEGIN TRANSACTION
BEGIN TRY

if @IS_REGLEMENT=1
	Begin
		set @sql='select @STATUT=STATUT_'+@ABBREV_DOCUMENT+',@MONTANT_REG=MONTANT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
		execute sp_executesql @sql,N'@STATUT varchar(20) output,@MONTANT_REG decimal(18,3) output',@STATUT output,@MONTANT_REG output
	End
else
	Begin
		if @IS_STOCK=1
			Begin
				if exists (select 1 from INVENTAIRE_STOCK where SOCIETE_ID=@ID_SOCIETE and STATUT_IS='ENCOURS')
					Begin
						if @ENVOI_RESULTAT=1 
							select -8 as RESULTAT
						else
							Begin
								set @RESULTAT=-8
								set @NUMERO_DOCUMENT=@NUMERO
							End
						if @TRANSACT=1 ROLLBACK TRANSACTION
						RETURN
					End
				if @STATUT_NS is not NULL
					Begin
						set @sql='select @N=ISNULL(count(1),0) from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+cast(@ID_DOCUMENT as varchar(MAX))
						+' and exists (select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.NUMERO_SERIE_OBLIGATOIRE_ARTICLE=1 and ISNULL(L.NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L,'''')='''' ) '
						execute sp_executesql @sql,N'@N int output',@N output
						if @N>0
							Begin
								if @ENVOI_RESULTAT=1 
									select -11 as RESULTAT
								else
									Begin
										set @RESULTAT=-11
										set @NUMERO_DOCUMENT=@NUMERO
									End
								if @TRANSACT=1 ROLLBACK TRANSACTION
								RETURN
							End
						End
				set @sql='select @STATUT=STATUT_'+@ABBREV_DOCUMENT+',@QUANTITE=ISNULL(TOTAL_QUANTITE_'+@ABBREV_DOCUMENT+',0) from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
				execute sp_executesql @sql,N'@STATUT varchar(20) output,@QUANTITE decimal(18,5) output',@STATUT output,@QUANTITE output			
			End
		if @TYPE_VA is NOT NULL
			Begin
				set @sql='select @STATUT=STATUT_'+@ABBREV_DOCUMENT+',@MONTANT_TTC=MONTANT_TTC_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
				execute sp_executesql @sql,N'@STATUT varchar(20) output,@MONTANT_TTC decimal(18,3) output',@STATUT output,@MONTANT_TTC output
			End
	End
if @IS_REGLEMENT=0
Begin
	set @sql='select @N_NULL=count(1) from '+@TABLE_DOCUMENT_LIGNE+' where ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID IS NULL and '+@ABBREV_DOCUMENT+'_ID='+cast(@ID_DOCUMENT as varchar(MAX))
	execute sp_executesql @sql,N'@N_NULL int output',@N_NULL output
End

if @STATUT is NULL
	if @ENVOI_RESULTAT=1 
		select -1 as RESULTAT
	else
		Begin
			set @RESULTAT=-1
			set @NUMERO_DOCUMENT=@NUMERO
		End

else
	if @STATUT='VALIDE'
		if @ENVOI_RESULTAT=1 
			select -2 as RESULTAT
		else
			Begin
				set @RESULTAT=-2
				set @NUMERO_DOCUMENT=@NUMERO
			End

	else
		if @STATUT='ANNULE'
			if @ENVOI_RESULTAT=1 
				select -3 as RESULTAT
			else
				Begin
					set @RESULTAT=-3
					set @NUMERO_DOCUMENT=@NUMERO
				End
		else
			Begin
				if (@MONTANT_TTC=0 and @TYPE_VA is not NULL)  
					if @ENVOI_RESULTAT=1 
						select -4 as RESULTAT
					else
						Begin
							set @RESULTAT=-4
							set @NUMERO_DOCUMENT=@NUMERO
						End
				else
					if (@QUANTITE=0 and @IS_STOCK=1)
						if @ENVOI_RESULTAT=1 
							select -9 as RESULTAT
						else
							Begin
								set @RESULTAT=-9
								set @NUMERO_DOCUMENT=@NUMERO
							End

					else
						if (@MONTANT_REG=0 and @IS_REGLEMENT=1)
							if @ENVOI_RESULTAT=1 
								select -10 as RESULTAT
							else
								Begin
									set @RESULTAT=-10
									set @NUMERO_DOCUMENT=@NUMERO
								End
						else
							if @N_NULL>0 and @IS_REGLEMENT=0
								if @ENVOI_RESULTAT=1 
									select -5 as RESULTAT
								else
									Begin
										set @RESULTAT=-5
										set @NUMERO_DOCUMENT=@NUMERO
									End
							else
								Begin
									if @ID_USER is NOT NULL
										set @sql='update '+@TABLE_DOCUMENT_UPDATE+' set STATUT_'+@ABBREV_DOCUMENT+'=''VALIDE'''+
											',USER_VALIDATION_'+@ABBREV_DOCUMENT+'_ID='+cast(@ID_USER as varchar(MAX))+',DATE_VALIDATION_'+@ABBREV_DOCUMENT+'=getdate()'+
											' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))



									else
										set @sql='update '+@TABLE_DOCUMENT_UPDATE+' set STATUT_'+@ABBREV_DOCUMENT+'=''VALIDE'''+
											',DATE_VALIDATION_'+@ABBREV_DOCUMENT+'=getdate()'+
											' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
									set @sql=@sql+';select @n=@@ROWCOUNT'
									execute sp_executesql @sql,N'@n int output',@n output
									if @n>0
									Begin
										if @DOCUMENT_STOCK_TD=1
												Begin
													set @sql='select @DOCUMENT_STOCK='+@TABLE_DOCUMENT_UPDATE+'_STOCK from SOCIETE where ID_SOCIETE='+CAST(@ID_SOCIETE as varchar(MAX))
													execute sp_executesql @sql,N'@DOCUMENT_STOCK bit output',@DOCUMENT_STOCK output
												End
										else
											set @DOCUMENT_STOCK=1

										if @MAJ_STOCK is NOT NULL and @DOCUMENT_STOCK=1
										Begin					
											--Stock depot
											set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
											+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
											+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) '
											+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'

											set @sql=@sql+' update STOCK_DEPOT set QUANTITE_STOCK_SD=D.QUANTITE_STOCK_SD'+@MAJ_STOCK+'C.QTE 
											from STOCK_DEPOT D inner join CTE C 
											on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SD_ID and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_SD_ID '
											execute sp_executesql @sql

											set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
											+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
											+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
											+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'

											set @sql=@sql+'insert STOCK_DEPOT (SOCIETE_ID,DEPOT_SD_ID,ARTICLE_SD_ID,QUANTITE_STOCK_SD)
											select '+CAST(@ID_SOCIETE as varchar(50))+',DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,'+@MAJ_STOCK+'C.QTE  from '
											+ ' CTE C where NOT EXISTS(select 1 from STOCK_DEPOT D where '
											+' C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_SD_ID and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SD_ID) '
											+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
											execute sp_executesql @sql

											--Stock proprit (taille,couleur)

											set @sql='select @n=ISNULL(count(1),0) from '+@TABLE_DOCUMENT_LIGNE
											+' T where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
											+' and TAILLE_'+@ABBREV_DOCUMENT+'_L_ID is NULL '
											+' and exists (select 1 from ARTICLE_PROPRIETE AT where AT.ARTICLE_ID=T.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and AT.TAILLE_ID is not NULL) '
											execute sp_executesql @sql,N'@n int output',@n output
											if @n>0
												Begin
													if @TRANSACT=1 ROLLBACK TRANSACTION
													if @ENVOI_RESULTAT=1 
														select -13 as RESULTAT
													else
														Begin
															set @RESULTAT=-13
															set @NUMERO_DOCUMENT=@NUMERO
														End
													RETURN
												End

											set @sql='select @n=ISNULL(count(1),0) from '+@TABLE_DOCUMENT_LIGNE
											+' T where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
											+' and COULEUR_'+@ABBREV_DOCUMENT+'_L_ID is NULL '
											+' and exists (select 1 from ARTICLE_PROPRIETE AT where AT.ARTICLE_ID=T.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and AT.COULEUR_ID is not NULL) '
											execute sp_executesql @sql,N'@n int output',@n output
											if @n>0
												Begin
													if @TRANSACT=1 ROLLBACK TRANSACTION
													if @ENVOI_RESULTAT=1 
														select -14 as RESULTAT
													else
														Begin
															set @RESULTAT=-14
															set @NUMERO_DOCUMENT=@NUMERO
														End
													RETURN
												End

											set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
											+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
											+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) '
											+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

											set @sql=@sql+' update STOCK_PROPRIETE set QUANTITE_STOCK_PROPRIETE=D.QUANTITE_STOCK_PROPRIETE'+@MAJ_STOCK+'C.QTE 
											from STOCK_PROPRIETE D inner join CTE C 
											on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_PROPRIETE_ID and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_PROPRIETE_ID,0) 
											and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_PROPRIETE_ID,0) and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_PROPRIETE_ID '
											execute sp_executesql @sql

											set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
											+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
											+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
											+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

											set @sql=@sql+'insert STOCK_PROPRIETE (SOCIETE_ID,TAILLE_PROPRIETE_ID,COULEUR_PROPRIETE_ID,ARTICLE_PROPRIETE_ID,DEPOT_PROPRIETE_ID,QUANTITE_STOCK_PROPRIETE)
											select '+CAST(@ID_SOCIETE as varchar(50))+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,'+@MAJ_STOCK+'C.QTE  from '
											+ ' CTE C where NOT EXISTS(select 1 from STOCK_PROPRIETE D where '
											+' ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_PROPRIETE_ID,0) and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_PROPRIETE_ID,0) and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_PROPRIETE_ID and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_PROPRIETE_ID) '
											+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
											execute sp_executesql @sql

											set @sql='delete STOCK_PROPRIETE where QUANTITE_STOCK_PROPRIETE=0'
											execute sp_executesql @sql

											--Stock bon reception
											if @STOCK_BRF=1 
												Begin
													set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
													+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
													+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) and BRF_'+@ABBREV_DOCUMENT+'_L_ID is not NULL'
													+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

													set @sql=@sql+' update STOCK_BON_RECEPTION set QUANTITE_SBRF=D.QUANTITE_SBRF'+@MAJ_STOCK+'C.QTE 
													from STOCK_BON_RECEPTION D inner join CTE C 
													on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID and C.BRF_'+@ABBREV_DOCUMENT+'_L_ID=D.BRF_SBRF_ID and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) 
													and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)'
													execute sp_executesql @sql

													set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
													+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
													+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) and BRF_'+@ABBREV_DOCUMENT+'_L_ID is not NULL'
													+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

													set @sql=@sql+'insert STOCK_BON_RECEPTION (SOCIETE_ID,BRF_SBRF_ID,ARTICLE_SBRF_ID,TAILLE_ID,COULEUR_ID,QUANTITE_SBRF)
													select '+CAST(@ID_SOCIETE as varchar(50))+',BRF_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,'+@MAJ_STOCK+'C.QTE  from '
													+ ' CTE C where NOT EXISTS(select 1 from STOCK_BON_RECEPTION D where '
													+ ' C.BRF_'+@ABBREV_DOCUMENT+'_L_ID=D.BRF_SBRF_ID and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID '
													+ ' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)  ) '
													+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
													execute sp_executesql @sql
												End
											

											if @ID_TYPE_DOCUMENT=25
												Begin
													set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID'
													+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
													+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
													+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

													set @sql=@sql+' update STOCK_BON_RECEPTION set QUANTITE_SBRF=D.QUANTITE_SBRF'+@MAJ_STOCK+'C.QTE 
													from STOCK_BON_RECEPTION D inner join CTE C 
													on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID and D.BRF_SBRF_ID='+CAST(@ID_DOCUMENT as varchar(50)) 
													+ ' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) 
													and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)'
													execute sp_executesql @sql

													set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID'
													+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
													+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
													+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

													set @sql=@sql+'insert STOCK_BON_RECEPTION (SOCIETE_ID,BRF_SBRF_ID,ARTICLE_SBRF_ID,TAILLE_ID,COULEUR_ID,QUANTITE_SBRF)
													select '+CAST(@ID_SOCIETE as varchar(50))+','+CAST(@ID_DOCUMENT as varchar(50))+',ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,'+@MAJ_STOCK+'C.QTE  from '
													+' CTE C where NOT EXISTS(select 1 from STOCK_BON_RECEPTION D where '
													+' D.BRF_SBRF_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID '
													+' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0)) '
													+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
													execute sp_executesql @sql
												End

											--STOCK NEGATIF
											select @STOCK_NEGATIF=STOCK_ZERO_NEGATIF from SOCIETE where ID_SOCIETE=@ID_SOCIETE
											if @STOCK_NEGATIF=0  
												Begin
													set @sql='select @NBRE_ARTICLE=count(1) from '+@TABLE_DOCUMENT_LIGNE
													+' T where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
													+' and exists (select 1 from VUE_STOCK_DEPOT D where D.QUANTITE<0'
													+' and D.ID_ARTICLE=T.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID '
													+' and D.ID_DEPOT=T.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'
													execute sp_executesql @sql,N'@NBRE_ARTICLE int output',@NBRE_ARTICLE output
													if @NBRE_ARTICLE>0
														Begin
															if @TRANSACT=1 ROLLBACK TRANSACTION
															if @ENVOI_RESULTAT=1 
																select -7 as RESULTAT
															else
																Begin
																	set @RESULTAT=-7
																	set @NUMERO_DOCUMENT=@NUMERO
																End
															RETURN
														End
												end

											if @TIERS is NOT NULL
												Begin
													set @sql='insert MOUVEMENT_STOCK (SOCIETE_ID,TYPE_TIERS_MS,TIERS_MS_ID,NUMERO_TIERS_MS,NOM_TIERS_MS,
													DEPOT_MS_ID,NOM_DEPOT_MS,ARTICLE_MS_ID,ARTICLE_CODE_MS,LIBELLE_ARTICLE_MS,
													LIBELLE_MS,TYPE_DOCUMENT_MS,DOCUMENT_MS_ID,NUMERO_DOCUMENT_MS,QUANTITE_ENTREE_MS,
													QUANTITE_SORTIE_MS,PRIX_ACHAT_MS,PRIX_ACHAT_TTC_MS,NUMERO_SERIE_MS,ANNULATION_DOCUMENT_MS,
													ORDRE_DOCUMENT_LIGNE_MS,DATE_DOCUMENT_MS,TAILLE_MS_ID,NOM_TAILLE_MS,COULEUR_MS_ID,NOM_COULEUR_MS'

													if @STOCK_BRF=1 or @ID_TYPE_DOCUMENT=25
														set @sql=@sql+',BRF_MS_ID,NUMERO_BRF_MS' 

													if @ID_USER is not NULL
														set @sql=@sql+',USER_CREATION_ID) ' 
													else
														set @sql=@sql+') ' 

													set @sql=@sql+' select ' 
													+ CAST(@ID_SOCIETE as varchar(50)) +','''
													+@TIERS+''','
													+ 'E.'+@TIERS+'_' + @ABBREV_DOCUMENT + '_ID,'
													+ 'E.NUMERO_'+@TIERS+'_' + @ABBREV_DOCUMENT + ','
													+ 'E.NOM_'+@TIERS+'_' + @ABBREV_DOCUMENT + ','
													+ 'L.DEPOT_' + @ABBREV_DOCUMENT + '_L_ID,'
													+ 'L.NOM_DEPOT_' + @ABBREV_DOCUMENT + '_L,'
													+ 'L.ARTICLE_' + @ABBREV_DOCUMENT + '_L_ID,'
													+ 'L.ARTICLE_CODE_' + @ABBREV_DOCUMENT + '_L,'
													+ 'L.LIBELLE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'''
													+ @NOM+' '+@NUMERO +''','
													+ CAST(@ID_TYPE_DOCUMENT as varchar(50)) +','
													+ CAST(@ID_DOCUMENT as varchar(50)) + ','
													+ 'E.NUMERO_' + @ABBREV_DOCUMENT + ','

													if @TYPE_MOUVEMENT='S'
														set @sql=@sql + '0,' + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'
													else
														set @sql=@sql + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0,'
													if @PAMP=1 
														set @sql=@sql+'L.PRIX_ACHAT_ARTICLE_HT_NET_DEVISE_'+@ABBREV_DOCUMENT+'_L,PRIX_ACHAT_ARTICLE_TTC_DEVISE_'+@ABBREV_DOCUMENT+'_L,'
													else
														set @sql=@sql+'NULL,NULL,'

													set @sql=@sql+'NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L,0'
													
													set @sql=@sql+',L.ORDRE_'+@ABBREV_DOCUMENT+'_L,E.DATE_'+@ABBREV_DOCUMENT

													set @sql=@sql+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,NOM_TAILLE_'+@ABBREV_DOCUMENT+'_L,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,NOM_COULEUR_'+@ABBREV_DOCUMENT+'_L'

													if @ID_TYPE_DOCUMENT=25
														set @sql=@sql+','+CAST(@ID_DOCUMENT as varchar(50))+',E.NUMERO_' + @ABBREV_DOCUMENT

													if @STOCK_BRF=1
														set @sql=@sql+',BRF_'+@ABBREV_DOCUMENT+'_L_ID,NUMERO_BRF_'+@ABBREV_DOCUMENT+'_L'

													if @ID_USER is not NULL
														set @sql=@sql+','+CAST(@ID_USER as varchar(50)) 

													set @sql=@sql+ ' from ' + @TABLE_DOCUMENT_LIGNE + ' L'
													+ ' INNER JOIN ' + @TABLE_DOCUMENT + ' E'
													+ ' on E.ID_' + @ABBREV_DOCUMENT + '=L.' + @ABBREV_DOCUMENT + '_ID '
													+ ' where E.ID_' + @ABBREV_DOCUMENT + '=' + CAST(@ID_DOCUMENT as varchar(50)) 
													+ ' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
													+ ' and ISNULL(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L,0)>0 '
													+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
													
													execute sp_executesql @sql
												End
											Else
												Begin
													set @sql='insert MOUVEMENT_STOCK (SOCIETE_ID,TYPE_TIERS_MS,
													DEPOT_MS_ID,NOM_DEPOT_MS,ARTICLE_MS_ID,ARTICLE_CODE_MS,LIBELLE_ARTICLE_MS,
													LIBELLE_MS,TYPE_DOCUMENT_MS,DOCUMENT_MS_ID,NUMERO_DOCUMENT_MS,QUANTITE_ENTREE_MS,
													QUANTITE_SORTIE_MS,NUMERO_SERIE_MS,ANNULATION_DOCUMENT_MS,
													ORDRE_DOCUMENT_LIGNE_MS,DATE_DOCUMENT_MS,TAILLE_MS_ID,NOM_TAILLE_MS,COULEUR_MS_ID,NOM_COULEUR_MS'

													if @STOCK_BRF=1
														set @sql=@sql+',BRF_MS_ID,NUMERO_BRF_MS' 

													if @ID_USER is not NULL
														set @sql=@sql+',USER_CREATION_ID) ' 
													else
														set @sql=@sql+') ' 

													set @sql=@sql+' select ' 
													+ CAST(@ID_SOCIETE as varchar(50)) +','
													+ '''STOCK'','
													+ 'L.DEPOT_' + @ABBREV_DOCUMENT + '_L_ID,'
													+ 'L.NOM_DEPOT_' + @ABBREV_DOCUMENT + '_L,'
													+ 'L.ARTICLE_' + @ABBREV_DOCUMENT + '_L_ID,'
													+ 'L.ARTICLE_CODE_' + @ABBREV_DOCUMENT + '_L,'
													+ 'L.LIBELLE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'''
													+ @NOM+' '+@NUMERO +''','
													+ CAST(@ID_TYPE_DOCUMENT as varchar(50)) +','
													+ CAST(@ID_DOCUMENT as varchar(50)) + ','
													+ 'E.NUMERO_' + @ABBREV_DOCUMENT + ','

													if @TYPE_MOUVEMENT='S'
														set @sql=@sql + '0,' + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'
													else
														set @sql=@sql + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0,'

													set @sql=@sql+'NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L,0'
													set @sql=@sql+',L.ORDRE_'+@ABBREV_DOCUMENT+'_L,E.DATE_'+@ABBREV_DOCUMENT
													set @sql=@sql+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,NOM_TAILLE_'+@ABBREV_DOCUMENT+'_L,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,NOM_COULEUR_'+@ABBREV_DOCUMENT+'_L'

													if @STOCK_BRF=1
														set @sql=@sql+',BRF_'+@ABBREV_DOCUMENT+'_L_ID,NUMERO_BRF_'+@ABBREV_DOCUMENT+'_L'

													if @ID_USER is not NULL
														set @sql=@sql+','+CAST(@ID_USER as varchar(50)) 

													set @sql=@sql+ ' from ' + @TABLE_DOCUMENT_LIGNE + ' L'
													+ ' INNER JOIN ' + @TABLE_DOCUMENT + ' E'
													+ ' on E.ID_' + @ABBREV_DOCUMENT + '=L.' + @ABBREV_DOCUMENT + '_ID '
													+ ' where E.ID_' + @ABBREV_DOCUMENT + '=' + CAST(@ID_DOCUMENT as varchar(50)) 
													+ ' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
													+ ' and ISNULL(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L,0)>0 '
													+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
													execute sp_executesql @sql
												End


											if @STOCK_BRF=1
												Begin
													set @sql='select @N=ISNULL(count(1),0) from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+cast(@ID_DOCUMENT as varchar(MAX))
													+' and exists (select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
													+' and BRF_'+@ABBREV_DOCUMENT+'_L_ID is NULL '
													execute sp_executesql @sql,N'@N int output',@N output
													if @N>0
														Begin
															if @ENVOI_RESULTAT=1 
																select -12 as RESULTAT
															else
																Begin
																	set @RESULTAT=-12
																	set @NUMERO_DOCUMENT=@NUMERO
																End
															if @TRANSACT=1 ROLLBACK TRANSACTION
															RETURN
														End													
												End									
										End 
									End

									if @SOLDE_TIERS is NOT NULL
										Begin
											set @sql='select @ID_TIERS='+@TIERS+'_'+@ABBREV_DOCUMENT+'_ID,@NET_PAYER=NET_PAYER_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
											execute sp_executesql @sql,N'@ID_TIERS numeric(18,0) output,@NET_PAYER decimal(18,5) output',@ID_TIERS output,@NET_PAYER output							

											if @ID_TYPE_DOCUMENT=8  --FACTURE CLIENT
												Begin
												set @sql='select @SOLDE_COMMERCIAL_CLIENT=SOLDE_COMMERCIAL_CLIENT,@SOLDE_COMMERCIAL_CLIENT_AUTORISE=SOLDE_COMMERCIAL_CLIENT_AUTORISE from VUE_CLIENT where ID_CLIENT='+CAST(@ID_TIERS as varchar(50))
												execute sp_executesql @sql,N'@SOLDE_COMMERCIAL_CLIENT decimal(18,3) output,@SOLDE_COMMERCIAL_CLIENT_AUTORISE decimal(18,3) output',@SOLDE_COMMERCIAL_CLIENT output,@SOLDE_COMMERCIAL_CLIENT_AUTORISE output
												if @SOLDE_COMMERCIAL_CLIENT_AUTORISE is NOT NULL
													if @SOLDE_COMMERCIAL_CLIENT_AUTORISE<@SOLDE_COMMERCIAL_CLIENT+@NET_PAYER
													Begin
														if @TRANSACT=1 ROLLBACK TRANSACTION
														if @ENVOI_RESULTAT=1 
															select -6 as RESULTAT,'Le Solde autoris du client est dpass !' 
														else
															Begin
																set @RESULTAT=-6
																set @NUMERO_DOCUMENT=@NUMERO
															End
														RETURN
													End
												End

											if @SOLDE_TIERS='+'
												Begin
													if @IS_DEVISE=1 
														set @sql='select @DEBIT=NET_PAYER_DEVISE_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
													else
														set @sql='select @DEBIT=NET_PAYER_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
													execute sp_executesql @sql,N'@DEBIT decimal(18,5) output,@DATE_DOCUMENT date output,@NOM_TIERS varchar(100) output',@DEBIT output,@DATE_DOCUMENT output,@NOM_TIERS output
													set @CREDIT=0
												End
											else
												Begin
													if @IS_DEVISE=1 
														set @sql='select @CREDIT=NET_PAYER_DEVISE_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
													else
														set @sql='select @CREDIT=NET_PAYER_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
													execute sp_executesql @sql,N'@CREDIT decimal(18,5) output,@DATE_DOCUMENT date output,@NOM_TIERS varchar(100) output',@CREDIT output,@DATE_DOCUMENT output,@NOM_TIERS output
													set @DEBIT=0
												End
											if (@TIERS='CLIENT')
												Begin
													set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')+CASE WHEN @DOCUMENT_TIERS is not NULL THEN ' ['+@DOCUMENT_TIERS+']' ELSE '' END
													set @sql='insert MOUVEMENT_CLIENT (SOCIETE_ID,CLIENT_MC_ID,NOM_CLIENT_MC,LIBELLE_MC,TYPE_DOCUMENT_MC,
													DOCUMENT_MC_ID,NUMERO_DOCUMENT_MC,DEBIT_MC,CREDIT_MC,USER_CREATION_ID,DATE_DOCUMENT_MC) values ('+CAST(@ID_SOCIETE as varchar(50))+
													','+CAST(@ID_TIERS as varchar(50))+','''+replace(@NOM_TIERS,'''','''''')+''','''+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
													CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@DEBIT as varchar(50))+','+CAST(@CREDIT as varchar(50))+','+
													CAST(@ID_USER as varchar(50))+','''+CAST(@DATE_DOCUMENT as varchar(50))+''')'
													execute sp_executesql @sql
												End
											else
												Begin
													set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')+CASE WHEN @DOCUMENT_TIERS is not NULL THEN ' ['+@DOCUMENT_TIERS+']' ELSE '' END
													set @sql='insert MOUVEMENT_FOURNISSEUR (SOCIETE_ID,FOURNISSEUR_MF_ID,NOM_FOURNISSEUR_MF,LIBELLE_MF,TYPE_DOCUMENT_MF,
													DOCUMENT_MF_ID,NUMERO_DOCUMENT_MF,DEBIT_MF,CREDIT_MF,USER_CREATION_ID,DATE_DOCUMENT_MF) values ('+CAST(@ID_SOCIETE as varchar(50))+
													','+CAST(@ID_TIERS as varchar(50))+','''+replace(@NOM_TIERS,'''','''''')+''','''+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
													CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@DEBIT as varchar(50))+','+CAST(@CREDIT as varchar(50))+','+
													CAST(@ID_USER as varchar(50))+','''+CAST(@DATE_DOCUMENT as varchar(50))+''')'
													execute sp_executesql @sql
												End
										End
									
									--MISE A JOUR PRIX ARTICLE
									if @MAJ_PRIX_ARTICLE_TD=1
										Begin
											set @sql='select @MAJ_PRIX_ARTICLE_SOCIETE=MAJ_PRIX_'+@TYPE_VA+'_SOCIETE from SOCIETE where ID_SOCIETE='+CAST(@ID_SOCIETE as varchar(50))
											execute sp_executesql @sql,N'@MAJ_PRIX_ARTICLE_SOCIETE bit output',@MAJ_PRIX_ARTICLE_SOCIETE output

											if @MAJ_PRIX_ARTICLE_SOCIETE=1
												Begin
													set @sql='select @ID_DEVISE=DEVISE_'+@ABBREV_DOCUMENT+'_ID from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50)) 
													execute sp_executesql @sql,N'@ID_DEVISE numeric(18,0) output',@ID_DEVISE output
													set @sql='select @ID_DEVISE_SOCIETE=DEVISE_SOCIETE_ID from SOCIETE where ID_SOCIETE='+CAST(@ID_SOCIETE as varchar(50))
													execute sp_executesql @sql,N'@ID_DEVISE_SOCIETE numeric(18,0) output',@ID_DEVISE_SOCIETE output
													if @ID_DEVISE=@ID_DEVISE_SOCIETE
														Begin
															set @sql='update ARTICLE set '
															+'[TVA_ARTICLE_ID]=L.TVA_ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,'
															+'[PRIX_'+@TYPE_VA+'_ARTICLE_HT]=L.PRIX_'+@TYPE_VA+'_ARTICLE_HT_BRUT_'+@ABBREV_DOCUMENT+'_L,'
															+'[PRIX_'+@TYPE_VA+'_ARTICLE_TTC]=L.PRIX_'+@TYPE_VA+'_ARTICLE_TTC_'+@ABBREV_DOCUMENT+'_L
															from ARTICLE A
															inner join '+@TABLE_DOCUMENT_LIGNE+' L on A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID 
															where L.'+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and ISNULL(L.PRIX_'+@TYPE_VA+'_ARTICLE_HT_NET_'+@ABBREV_DOCUMENT+'_L,0)<>0' 
															execute sp_executesql @sql										
														End
													else
														Begin
															if @TYPE_VA='ACHAT'
																Begin
																	set @sql='update ARTICLE set '
																	+'[TVA_ARTICLE_ID]=L.TVA_ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,'
																	+'[PRIX_'+@TYPE_VA+'_ARTICLE_HT]=L.PRIX_'+@TYPE_VA+'_ARTICLE_HT_BRUT_DEVISE_'+@ABBREV_DOCUMENT+'_L,'
																	+'[PRIX_'+@TYPE_VA+'_ARTICLE_TTC]=L.PRIX_'+@TYPE_VA+'_ARTICLE_TTC_DEVISE_'+@ABBREV_DOCUMENT+'_L
																	from ARTICLE A
																	inner join '+@TABLE_DOCUMENT_LIGNE+' L on A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID 
																	where L.'+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and ISNULL(L.PRIX_'+@TYPE_VA+'_ARTICLE_HT_NET_'+@ABBREV_DOCUMENT+'_L,0)<>0' 
																	execute sp_executesql @sql										
																End

															set @sql='update ARTICLE_DEVISE set '
															+' PRIX_'+@TYPE_VA+'_ARTICLE_HT_ARTICLE_L=L.PRIX_'+@TYPE_VA+'_ARTICLE_HT_BRUT_'+@ABBREV_DOCUMENT+'_L'
															+' from ARTICLE_DEVISE A
															inner join '+@TABLE_DOCUMENT_LIGNE+' L on A.ARTICLE_ID=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID 
															and DEVISE_ARTICLE_L_ID='+CAST(@ID_DEVISE as varchar(50))+
															' where L.'+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and ISNULL(L.PRIX_'+@TYPE_VA+'_ARTICLE_HT_NET_'+@ABBREV_DOCUMENT+'_L,0)<>0' 
															execute sp_executesql @sql		
															
														End

												--Mise  jour des charges
												if @ID_TYPE_DOCUMENT=26 --Facture fournisseur
													Begin
														select @NOMBRE_DECIMAL=NOMBRE_DECIMAL from VUE_SOCIETE where ID_SOCIETE=@ID_SOCIETE

														select @MONTANT_HT_NET_FCF=MONTANT_HT_NET_FCF from FACTURE_FOURNISSEUR where ID_FCF=@ID_DOCUMENT

														set @sql=';with CTE as (select ARTICLE_FCF_L_ID,ROUND(PRIX_ACHAT_ARTICLE_HT_NET_FCF_L/'+CAST(@MONTANT_HT_NET_FCF as varchar(50))+',5) as POURC
														from FACTURE_FOURNISSEUR_LIGNE where FCF_ID='+CAST(@ID_DOCUMENT as varchar(50))+')
														,CTE1 as (select C.CHARGE_ID,F.ARTICLE_FCF_L_ID as ID_ARTICLE,C.MONTANT_CHARGE_FCF as MONTANT,CTE.POURC 
														from FACTURE_FOURNISSEUR_LIGNE F
														inner join FACTURE_FOURNISSEUR_CHARGE C on F.FCF_ID=C.FCF_ID
														inner join CTE on CTE.ARTICLE_FCF_L_ID=F.ARTICLE_FCF_L_ID
														where F.FCF_ID='+CAST(@ID_DOCUMENT as varchar(50))+')'
														+' update CHARGE_ARTICLE set MONTANT_CHARGE_ARTICLE=CAST(CTE1.MONTANT*CTE1.POURC as decimal(18,'+CAST(@NOMBRE_DECIMAL as varchar(50))+'))
														from CHARGE_ARTICLE C
														inner join CTE1 on CTE1.ID_ARTICLE=C.ARTICLE_CHARGE_ID and CTE1.CHARGE_ID=C.CHARGE_ID'
														execute sp_executesql @sql


														set @sql=';with CTE as (select ARTICLE_FCF_L_ID,ROUND(PRIX_ACHAT_ARTICLE_HT_NET_FCF_L/'+CAST(@MONTANT_HT_NET_FCF as varchar(50))+',5) as POURC
														from FACTURE_FOURNISSEUR_LIGNE where FCF_ID='+CAST(@ID_DOCUMENT as varchar(50))+')
														,CTE1 as (select C.CHARGE_ID,F.ARTICLE_FCF_L_ID as ID_ARTICLE,C.MONTANT_CHARGE_FCF as MONTANT,CTE.POURC 
														from FACTURE_FOURNISSEUR_LIGNE F
														inner join FACTURE_FOURNISSEUR_CHARGE C on F.FCF_ID=C.FCF_ID
														inner join CTE on CTE.ARTICLE_FCF_L_ID=F.ARTICLE_FCF_L_ID
														where F.FCF_ID='+CAST(@ID_DOCUMENT as varchar(50))+')'
														+' insert CHARGE_ARTICLE (ARTICLE_CHARGE_ID,CHARGE_ID,MONTANT_CHARGE_ARTICLE)
														select ID_ARTICLE,CHARGE_ID,CAST(MONTANT*POURC as decimal(18,'+CAST(@NOMBRE_DECIMAL as varchar(50))+')) from CTE1 
														where not exists (select 1 from CHARGE_ARTICLE CA where CA.ARTICLE_CHARGE_ID=CTE1.ID_ARTICLE and CA.CHARGE_ID=CTE1.CHARGE_ID)'
														execute sp_executesql @sql
													End

												End
										End

									if @DOCUMENT_STOCK_TD=1
										Begin
											set @sql='update '+@TABLE_DOCUMENT_UPDATE+' set MOUVEMENT_STOCK_DOCUMENT_'+@ABBREV_DOCUMENT+'='+CAST(@DOCUMENT_STOCK as varchar(50))
											+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
											execute sp_executesql @sql
										End
									set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_DESTINATION=''VALIDE'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
											+' and TYPE_DT_DESTINATION_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
											+' and DT_DESTINATION_ID='+CAST(@ID_DOCUMENT as varchar(50))
									execute sp_executesql @sql
									if @ENVOI_RESULTAT=1 
										select 1 as RESULTAT
									else
										Begin
											set @RESULTAT=1
											set @NUMERO_DOCUMENT=@NUMERO
										End
								End
			End

END TRY
BEGIN CATCH  
	if @TRANSACT=1 ROLLBACK TRANSACTION
	insert SQL_ERREUR (QUERY) values (@SQL)
	if @ENVOI_RESULTAT=1 
		select -99 as RESULTAT,ERROR_NUMBER() 
	else
		Begin
			set @RESULTAT=-99
			set @NUMERO_DOCUMENT=@NUMERO
		End

	RETURN
END CATCH; 
if @TRANSACT=1 COMMIT TRANSACTION

END


GO


--------------------------------------------------------------------------------------------


ALTER PROCEDURE [dbo].[PRC_ANNULER_DOCUMENT] 
	@ID_TYPE_DOCUMENT numeric(18,0),@ID_SOCIETE numeric(18,0),@ID_DOCUMENT numeric(18,0),@ID_USER numeric(18,0)

AS
BEGIN
declare @sql nvarchar(MAX)
declare @n int
declare @TABLE_DOCUMENT varchar(100)
declare @TABLE_DOCUMENT_UPDATE varchar(100)
declare @ABBREV_DOCUMENT varchar(10)
declare @ANNULER_STOCK char(1)
declare @ANNULER_SOLDE char(1)
declare @TIERS varchar(50)
declare @ID_TIERS numeric(18,0)
declare @NOM_TIERS varchar(100)
declare @DEBIT decimal(18,5)
declare @CREDIT decimal(18,5)
declare @NOM varchar(50)
declare @NUMERO varchar(50)
declare @DATE_DOCUMENT date
declare @TABLE_DOCUMENT_LIGNE varchar(100)
declare @TYPE_MOUVEMENT char(1)
declare @STATUT varchar(20)
declare @ID_DEVISE numeric(18,0)
declare @DEVISE varchar(50)
declare @LIBELLE_MOUVEMENT_REGLEMENT varchar(200)
declare @IS_DEVISE bit
declare @IS_REMBOURSEMENT bit
declare @REMBOURSEMENT bit 
declare @PAMP bit
declare @DOCUMENT_TIERS varchar(50)
declare @DOCUMENT_STOCK_TD bit 
declare @DOCUMENT_STOCK bit 
declare @STOCK_BRF bit

SET DATEFORMAT dmy

select @TABLE_DOCUMENT=TABLE_TD,@ABBREV_DOCUMENT=ABBREVIATION_TD,@TABLE_DOCUMENT_LIGNE=TABLE_LIGNE_TD,
@TYPE_MOUVEMENT=TYPE_MOUVEMENT_TD,@IS_REMBOURSEMENT=IS_REMBOURSEMENT,@PAMP=PAMP_TD,
@DOCUMENT_STOCK_TD=DOCUMENT_STOCK_TD,@TABLE_DOCUMENT_UPDATE=TABLE_UPDATE_TD,@STOCK_BRF=STOCK_BRF 
from TYPE_DOCUMENT where ID_TD=@ID_TYPE_DOCUMENT

BEGIN TRANSACTION

BEGIN TRY

set @sql='select  @STATUT=STATUT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
execute sp_executesql @sql,N'@STATUT varchar(20) output',@STATUT output


--Les documents encours sont annules sans aucunes actions sur le stock et les mouvements
if @STATUT='ENCOURS' 
	Begin
		set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_SOURCE=''ANNULE'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
				+' and TYPE_DT_SOURCE_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
				+' and DT_SOURCE_ID='+CAST(@ID_DOCUMENT as varchar(50))
		execute sp_executesql @sql

		set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_DESTINATION=''ANNULE'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
				+' and TYPE_DT_DESTINATION_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
				+' and DT_DESTINATION_ID='+CAST(@ID_DOCUMENT as varchar(50))
		execute sp_executesql @sql

		set @sql='update '+@TABLE_DOCUMENT+' set STATUT_'+@ABBREV_DOCUMENT+'=''ANNULE'''+
		',USER_ANNULATION_'+@ABBREV_DOCUMENT+'_ID='+cast(@ID_USER as varchar(MAX))+',DATE_ANNULATION_'+@ABBREV_DOCUMENT+'=getdate()'+
		' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
		set @sql=@sql+';select @n=@@ROWCOUNT'
		execute sp_executesql @sql,N'@n int output',@n output
		select 1 AS RESULTAT,@n
	End
Else
Begin
	--Vrifier si le documents a t transfr vers un document non annul
	set @sql='select @n=ISNULL(count(1),0) from TRANSFERT_DOCUMENT where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
			+' and TYPE_DT_SOURCE_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
			+' and DT_SOURCE_ID='+CAST(@ID_DOCUMENT as varchar(50))
			+' and DT_STATUT_DESTINATION<>''ANNULE'''
	execute sp_executesql @sql,N'@n int output',@n output
	--Le document n'a pas t transfr vers un document non annul
	if @n=0
		Begin

			select @ANNULER_SOLDE=ANNULER_SOLDE,@ANNULER_STOCK=ANNULER_STOCK,@TIERS=TIERS_TD,@NOM=NOM_TD,@IS_DEVISE=IS_DEVISE from TYPE_DOCUMENT where ID_TD=@ID_TYPE_DOCUMENT
			--Le document est en devise diffrend de la devise de la socit
			if @IS_DEVISE=1
				Begin
					set @sql='select  @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+',@ID_TIERS='+@TIERS+'_'+@ABBREV_DOCUMENT+'_ID,@ID_DEVISE=DEVISE_'+@ABBREV_DOCUMENT+'_ID from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
					execute sp_executesql @sql,N'@ID_TIERS numeric(18,0) output,@NUMERO varchar(50) output,@ID_DEVISE numeric(18,0) output',@ID_TIERS output,@NUMERO output,@ID_DEVISE output
					select @DEVISE=LIBELLE_DEVISE from VUE_DEVISE where ID_DEVISE=@ID_DEVISE
				End
			Else
				Begin
					-- Les documents qui ont un client ou fournisseur
					if @TIERS IS NOT NULL
						Begin
							set @sql='select  @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+',@ID_TIERS='+@TIERS+'_'+@ABBREV_DOCUMENT+'_ID from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@ID_TIERS numeric(18,0) output,@NUMERO varchar(50) output',@ID_TIERS output,@NUMERO output
						End
					Else
					-- Les documents comme bon d'entre et sortie stock
						Begin
							set @sql='select  @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@ID_TIERS numeric(18,0) output,@NUMERO varchar(50) output',@ID_TIERS output,@NUMERO output
						End
				End
			if @DOCUMENT_STOCK_TD=1
				Begin
					set @sql='select @DOCUMENT_STOCK=MOUVEMENT_STOCK_DOCUMENT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT_UPDATE+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
					execute sp_executesql @sql,N'@DOCUMENT_STOCK bit output',@DOCUMENT_STOCK output
				End
			else
				set @DOCUMENT_STOCK=1

			--Test sur les documents qui touche le stock lors de leur annulation
			if @ANNULER_STOCK is NOT NULL and @DOCUMENT_STOCK=1
				Begin
					-- Bloquer le traitement quand il y a dj un inventaire en cours
					if exists (select 1 from INVENTAIRE_STOCK where SOCIETE_ID=@ID_SOCIETE and STATUT_IS='ENCOURS')
						Begin
							select -8 as RESULTAT
							ROLLBACK TRANSACTION
							RETURN
						End

						--Mise  jour du stock par dpt des article existant dans la table
						set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
						+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
						+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
						+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+' update STOCK_DEPOT set QUANTITE_STOCK_SD=D.QUANTITE_STOCK_SD'+@ANNULER_STOCK+'C.QTE 
						from STOCK_DEPOT D inner join CTE C 
						on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SD_ID and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_SD_ID '+
						' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql

						--Insertion des articles du stock par dpt qui n'existent pas dans la table
						set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
						+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
						+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
						+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+'insert STOCK_DEPOT (SOCIETE_ID,DEPOT_SD_ID,ARTICLE_SD_ID,QUANTITE_STOCK_SD)
						select '+CAST(@ID_SOCIETE as varchar(50))+',DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE from '
						+ ' CTE C where NOT EXISTS(select 1 from STOCK_DEPOT D where '
						+' C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_SD_ID and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SD_ID) '
						+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql
						
						-- Stock par proprit

						set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
						+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
						+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
						+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+' update STOCK_PROPRIETE set QUANTITE_STOCK_PROPRIETE=D.QUANTITE_STOCK_PROPRIETE'+@ANNULER_STOCK+'C.QTE 
						from STOCK_PROPRIETE D inner join CTE C '
						+' on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_PROPRIETE_ID and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_PROPRIETE_ID,0) '
						+' and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_PROPRIETE_ID,0) and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_PROPRIETE_ID '
						+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql
			
						set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
						+' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
						+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
						+' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+'insert STOCK_PROPRIETE (SOCIETE_ID,TAILLE_PROPRIETE_ID,COULEUR_PROPRIETE_ID,ARTICLE_PROPRIETE_ID,DEPOT_PROPRIETE_ID,QUANTITE_STOCK_PROPRIETE) '
						+' select '+CAST(@ID_SOCIETE as varchar(50))+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE  from '
						+' CTE C where NOT EXISTS(select 1 from STOCK_PROPRIETE D where '
						+' ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_PROPRIETE_ID,0) and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_PROPRIETE_ID,0) and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_PROPRIETE_ID and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_PROPRIETE_ID) '
						+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql

						set @sql='delete STOCK_PROPRIETE where QUANTITE_STOCK_PROPRIETE=0'
						execute sp_executesql @sql

						--Stock bon reception
						if @STOCK_BRF=1 
							Begin
								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) and BRF_'+@ABBREV_DOCUMENT+'_L_ID is not NULL'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+' update STOCK_BON_RECEPTION set QUANTITE_SBRF=D.QUANTITE_SBRF'+@ANNULER_STOCK+'C.QTE 
								from STOCK_BON_RECEPTION D inner join CTE C 
								on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID and C.BRF_'+@ABBREV_DOCUMENT+'_L_ID=D.BRF_SBRF_ID and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) 
								and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)'
								execute sp_executesql @sql

								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) and BRF_'+@ABBREV_DOCUMENT+'_L_ID is not NULL'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+'insert STOCK_BON_RECEPTION (SOCIETE_ID,BRF_SBRF_ID,ARTICLE_SBRF_ID,TAILLE_ID,COULEUR_ID,QUANTITE_SBRF)
								select '+CAST(@ID_SOCIETE as varchar(50))+',BRF_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE  from '
								+ ' CTE C where NOT EXISTS(select 1 from STOCK_BON_RECEPTION D where '
								+ ' C.BRF_'+@ABBREV_DOCUMENT+'_L_ID=D.BRF_SBRF_ID and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID '
								+ ' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)  ) '
								+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
								execute sp_executesql @sql


								set @sql='delete STOCK_BON_RECEPTION where QUANTITE_SBRF=0'
								execute sp_executesql @sql
							End
						if @ID_TYPE_DOCUMENT=25
							Begin
								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+' update STOCK_BON_RECEPTION set QUANTITE_SBRF=D.QUANTITE_SBRF'+@ANNULER_STOCK+'C.QTE 
								from STOCK_BON_RECEPTION D inner join CTE C 
								on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID and D.BRF_SBRF_ID='+CAST(@ID_DOCUMENT as varchar(50)) 
								+ ' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) 
								and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)'
								execute sp_executesql @sql

								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+'insert STOCK_BON_RECEPTION (SOCIETE_ID,BRF_SBRF_ID,ARTICLE_SBRF_ID,TAILLE_ID,COULEUR_ID,QUANTITE_SBRF)
								select '+CAST(@ID_SOCIETE as varchar(50))+','+CAST(@ID_DOCUMENT as varchar(50))+',ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE  from '
								+' CTE C where NOT EXISTS(select 1 from STOCK_BON_RECEPTION D where '
								+' D.BRF_SBRF_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID '
								+' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0)) '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
								execute sp_executesql @sql

								set @sql='delete STOCK_BON_RECEPTION where QUANTITE_SBRF=0'
								execute sp_executesql @sql
							End

						-- Mouvement stock (client/Fournisseur)
						if @TIERS IS NOT NULL
							Begin
								set @sql='insert MOUVEMENT_STOCK (SOCIETE_ID,TYPE_TIERS_MS,TIERS_MS_ID,NUMERO_TIERS_MS,NOM_TIERS_MS,
								DEPOT_MS_ID,NOM_DEPOT_MS,ARTICLE_MS_ID,ARTICLE_CODE_MS,LIBELLE_ARTICLE_MS,
								LIBELLE_MS,TYPE_DOCUMENT_MS,DOCUMENT_MS_ID,NUMERO_DOCUMENT_MS,QUANTITE_ENTREE_MS,
								QUANTITE_SORTIE_MS,PRIX_ACHAT_MS,NUMERO_SERIE_MS,ANNULATION_DOCUMENT_MS,
								ORDRE_DOCUMENT_LIGNE_MS,DATE_DOCUMENT_MS,TAILLE_MS_ID,NOM_TAILLE_MS,COULEUR_MS_ID,NOM_COULEUR_MS'

								if @STOCK_BRF=1 or @ID_TYPE_DOCUMENT=25
									set @sql=@sql+',BRF_MS_ID,NUMERO_BRF_MS' 

								if @ID_USER is not NULL
									set @sql=@sql+',USER_CREATION_ID) ' 
								else
									set @sql=@sql+') ' 

								set @sql=@sql+' select ' 
								+ CAST(@ID_SOCIETE as varchar(50)) +','''
								+@TIERS+''','
								+ 'E.'+@TIERS+'_' + @ABBREV_DOCUMENT + '_ID,'
								+ 'E.NUMERO_'+@TIERS+'_' + @ABBREV_DOCUMENT + ','
								+ 'E.NOM_'+@TIERS+'_' + @ABBREV_DOCUMENT + ','
								+ 'L.DEPOT_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.NOM_DEPOT_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.ARTICLE_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.ARTICLE_CODE_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.LIBELLE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,''ANNULATION '
								+ @NOM+' '+@NUMERO +''','
								+ CAST(@ID_TYPE_DOCUMENT as varchar(50)) +','
								+ CAST(@ID_DOCUMENT as varchar(50)) + ','
								+ 'E.NUMERO_' + @ABBREV_DOCUMENT + ','

								if @TYPE_MOUVEMENT='E'
									set @sql=@sql + '0,' + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'
								else
									set @sql=@sql + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0,'
								if @PAMP=1 
									set @sql=@sql+'L.PRIX_ACHAT_ARTICLE_HT_NET_DEVISE_'+@ABBREV_DOCUMENT+'_L,'
								else
									set @sql=@sql+'NULL,'
									
								set @sql=@sql+'NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L,1,'
								set @sql=@sql+'L.ORDRE_'+@ABBREV_DOCUMENT+'_L,E.DATE_'+@ABBREV_DOCUMENT
								set @sql=@sql+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,NOM_TAILLE_'+@ABBREV_DOCUMENT+'_L,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,NOM_COULEUR_'+@ABBREV_DOCUMENT+'_L'

								if @ID_TYPE_DOCUMENT=25
									set @sql=@sql+','+CAST(@ID_DOCUMENT as varchar(50))+',E.NUMERO_' + @ABBREV_DOCUMENT

								if @STOCK_BRF=1
									set @sql=@sql+',BRF_'+@ABBREV_DOCUMENT+'_L_ID,NUMERO_BRF_'+@ABBREV_DOCUMENT+'_L'

								if @ID_USER is not NULL
									set @sql=@sql+','+CAST(@ID_USER as varchar(50)) 

								+ ' from ' + @TABLE_DOCUMENT_LIGNE + ' L'
								+ ' INNER JOIN ' + @TABLE_DOCUMENT + ' E'
								+ ' on E.ID_' + @ABBREV_DOCUMENT + '=L.' + @ABBREV_DOCUMENT + '_ID '
								+ ' where E.ID_' + @ABBREV_DOCUMENT + '=' + CAST(@ID_DOCUMENT as varchar(50)) 
								+ ' and ISNULL(L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0)>0 '
								+ ' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
								+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
								execute sp_executesql @sql
							End
						Else
							--Mouvement pour les documents qui n'ont de tiers comme bon entre et sortie
							Begin
								set @sql='insert MOUVEMENT_STOCK (SOCIETE_ID,TYPE_TIERS_MS,
								DEPOT_MS_ID,NOM_DEPOT_MS,ARTICLE_MS_ID,ARTICLE_CODE_MS,LIBELLE_ARTICLE_MS,
								LIBELLE_MS,TYPE_DOCUMENT_MS,DOCUMENT_MS_ID,NUMERO_DOCUMENT_MS,QUANTITE_ENTREE_MS,
								QUANTITE_SORTIE_MS,NUMERO_SERIE_MS,ANNULATION_DOCUMENT_MS,
								ORDRE_DOCUMENT_LIGNE_MS,DATE_DOCUMENT_MS,TAILLE_MS_ID,NOM_TAILLE_MS,COULEUR_MS_ID,NOM_COULEUR_MS'

								if @STOCK_BRF=1
									set @sql=@sql+',BRF_MS_ID,NUMERO_BRF_MS' 

								if @ID_USER is not NULL
									set @sql=@sql+',USER_CREATION_ID) ' 
								else
									set @sql=@sql+') ' 

								set @sql=@sql+' select ' 
								+ CAST(@ID_SOCIETE as varchar(50)) +','
								+ '''STOCK'','
								+ 'L.DEPOT_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.NOM_DEPOT_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.ARTICLE_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.ARTICLE_CODE_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.LIBELLE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,''ANNULATION '
								+ @NOM+' '+@NUMERO +''','
								+ CAST(@ID_TYPE_DOCUMENT as varchar(50)) +','
								+ CAST(@ID_DOCUMENT as varchar(50)) + ','
								+ 'E.NUMERO_' + @ABBREV_DOCUMENT + ','

								if @TYPE_MOUVEMENT='E'
									set @sql=@sql + '0,' + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'
								else
									set @sql=@sql + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0,'
									
								set @sql=@sql+'NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L,1,'
								set @sql=@sql+'L.ORDRE_'+@ABBREV_DOCUMENT+'_L,E.DATE_'+@ABBREV_DOCUMENT
								set @sql=@sql+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,NOM_TAILLE_'+@ABBREV_DOCUMENT+'_L,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,NOM_COULEUR_'+@ABBREV_DOCUMENT+'_L'

								if @STOCK_BRF=1
									set @sql=@sql+',BRF_'+@ABBREV_DOCUMENT+'_L_ID,NUMERO_BRF_'+@ABBREV_DOCUMENT+'_L'

								if @ID_USER is not NULL
									set @sql=@sql+','+CAST(@ID_USER as varchar(50)) 

								+ ' from ' + @TABLE_DOCUMENT_LIGNE + ' L'
								+ ' INNER JOIN ' + @TABLE_DOCUMENT + ' E'
								+ ' on E.ID_' + @ABBREV_DOCUMENT + '=L.' + @ABBREV_DOCUMENT + '_ID '
								+ ' where E.ID_' + @ABBREV_DOCUMENT + '=' + CAST(@ID_DOCUMENT as varchar(50)) 
								+ ' and ISNULL(L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0)>0 '
								+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
								execute sp_executesql @sql
							End
						set @sql='Update MOUVEMENT_STOCK set ANNULATION_DOCUMENT_MS=1 where TYPE_DOCUMENT_MS='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
						+' and DOCUMENT_MS_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and DEVALIDATION_DOCUMENT_MS=0 '
						execute sp_executesql @sql

				End
		
			if @ANNULER_SOLDE is NOT NULL
				Begin
					if @ANNULER_SOLDE='+'
						Begin
							if @IS_DEVISE=1
								set @sql='select @DEBIT=NET_PAYER_DEVISE_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							else
								set @sql='select @DEBIT=NET_PAYER_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))

							execute sp_executesql @sql,N'@DEBIT decimal(18,5) output,@DATE_DOCUMENT date output,@NOM_TIERS varchar(100) output',@DEBIT output,@DATE_DOCUMENT output,@NOM_TIERS output
							set @CREDIT=0
						End
					else
						Begin
							if @IS_DEVISE=1
								set @sql='select @CREDIT=NET_PAYER_DEVISE_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							else
								set @sql='select @CREDIT=NET_PAYER_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@CREDIT decimal(18,5) output,@DATE_DOCUMENT date output,@NOM_TIERS varchar(100) output',@CREDIT output,@DATE_DOCUMENT output,@NOM_TIERS output
							set @DEBIT=0
						End
					if @TIERS is NOT NULL
						Begin
							set @sql='select @DOCUMENT_TIERS=DOCUMENT_'+@TIERS+'_'+@ABBREV_DOCUMENT 
								+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
							execute sp_executesql @sql,N'@DOCUMENT_TIERS varchar(50) output',@DOCUMENT_TIERS output
						End
					Else
						set @DOCUMENT_TIERS=NULL

					--Mouvement tiers (client/fournisseur)
					if (@TIERS='CLIENT')
						Begin
							set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')+CASE WHEN @DOCUMENT_TIERS is not NULL THEN ' ['+@DOCUMENT_TIERS+']' ELSE '' END

							set @sql='insert MOUVEMENT_CLIENT (SOCIETE_ID,CLIENT_MC_ID,NOM_CLIENT_MC,LIBELLE_MC,TYPE_DOCUMENT_MC,
							DOCUMENT_MC_ID,NUMERO_DOCUMENT_MC,DEBIT_MC,CREDIT_MC,USER_CREATION_ID,DATE_DOCUMENT_MC) values ('+CAST(@ID_SOCIETE as varchar(50))+
							','+CAST(@ID_TIERS as varchar(50))+','''+replace(@NOM_TIERS,'''','''''')+''',''ANNULATION '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
							CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@DEBIT as varchar(50))+','+CAST(@CREDIT as varchar(50))+','+
							CAST(@ID_USER as varchar(50))+','''+CAST(@DATE_DOCUMENT as varchar(50))+''')'
							execute sp_executesql @sql

							--Marquer les mouvements d'annulation
							set @sql='update MOUVEMENT_CLIENT set ANNULE_MC=1 where '
							+' SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
							+' and DOCUMENT_MC_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+' and TYPE_DOCUMENT_MC='''+@ABBREV_DOCUMENT+''''
							execute sp_executesql @sql
						End
					else
						Begin
							set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')+CASE WHEN @DOCUMENT_TIERS is not NULL THEN ' ['+@DOCUMENT_TIERS+']' ELSE '' END

							set @sql='insert MOUVEMENT_FOURNISSEUR (SOCIETE_ID,FOURNISSEUR_MF_ID,NOM_FOURNISSEUR_MF,LIBELLE_MF,TYPE_DOCUMENT_MF,
							DOCUMENT_MF_ID,NUMERO_DOCUMENT_MF,DEBIT_MF,CREDIT_MF,USER_CREATION_ID) values ('+CAST(@ID_SOCIETE as varchar(50))+
							','+CAST(@ID_TIERS as varchar(50))+','''+replace(@NOM_TIERS,'''','''''')+''',''ANNULATION '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
							CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@DEBIT as varchar(50))+','+CAST(@CREDIT as varchar(50))+','+
							CAST(@ID_USER as varchar(50))+','''+CAST(@DATE_DOCUMENT as varchar(50))+''')'
							execute sp_executesql @sql

							--Marquer les mouvements d'annulation
							set @sql='update MOUVEMENT_FOURNISSEUR set ANNULE_MF=1 where '
							+' SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
							+' and DOCUMENT_MF_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+' and TYPE_DOCUMENT_MF='''+@ABBREV_DOCUMENT+''''
							execute sp_executesql @sql
						End

					--REMBOURSEMENT AVOIR
					if @IS_REMBOURSEMENT=1 
						Begin
							set @sql='select @REMBOURSEMENT=REMBOURSEMENT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT
							+ ' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@REMBOURSEMENT bit output',@REMBOURSEMENT output
							if @REMBOURSEMENT=1 
								if (@TIERS='CLIENT')
									Begin
										set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')
										set @sql='insert MOUVEMENT_CLIENT (SOCIETE_ID,CLIENT_MC_ID,NOM_CLIENT_MC,LIBELLE_MC,TYPE_DOCUMENT_MC,
										DOCUMENT_MC_ID,NUMERO_DOCUMENT_MC,DEBIT_MC,CREDIT_MC,USER_CREATION_ID) values ('+CAST(@ID_SOCIETE as varchar(50))+
										','+CAST(@ID_TIERS as varchar(50))+','''+@NOM_TIERS+''',''ANNULATION REMBOURSEMENT '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
										CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@CREDIT as varchar(50))+','+CAST(@DEBIT as varchar(50))+','+CAST(@ID_USER as varchar(50))+')'
										execute sp_executesql @sql
									End
								else
									Begin
										set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')
										set @sql='insert MOUVEMENT_FOURNISSEUR (SOCIETE_ID,FOURNISSEUR_MF_ID,NOM_FOURNISSEUR_MF,LIBELLE_MF,TYPE_DOCUMENT_MF,
										DOCUMENT_MF_ID,NUMERO_DOCUMENT_MF,DEBIT_MF,CREDIT_MF,USER_CREATION_ID) values ('+CAST(@ID_SOCIETE as varchar(50))+
										','+CAST(@ID_TIERS as varchar(50))+','''+@NOM_TIERS+''',''ANNULATION REMBOURSEMENT '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
										CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@CREDIT as varchar(50))+','+CAST(@DEBIT as varchar(50))+','+CAST(@ID_USER as varchar(50))+')'
										execute sp_executesql @sql
									End
						End
				End

			--Mise  jour de la table des transferts
			set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_SOURCE=''ANNULE'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
					+' and TYPE_DT_SOURCE_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
					+' and DT_SOURCE_ID='+CAST(@ID_DOCUMENT as varchar(50))
			execute sp_executesql @sql

			set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_DESTINATION=''ANNULE'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
					+' and TYPE_DT_DESTINATION_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
					+' and DT_DESTINATION_ID='+CAST(@ID_DOCUMENT as varchar(50))
			execute sp_executesql @sql

			--Annulation Rglement de BL
			if @ID_TYPE_DOCUMENT=6
				Begin
					set @sql='update REGLEMENT_CLIENT_BL set STATUT_RBC=''ANNULE'',
					USER_ANNULATION_RBC_ID='+CAST(@ID_USER as varchar(50))+',DATE_ANNULATION_RBC=getdate() 
					from REGLEMENT_CLIENT_BL R
					where exists(select 1 from REGLEMENT_CLIENT_BL_LIGNE L where R.ID_RBC=L.RBC_ID and L.BLC_RBC_L_ID='+CAST(@ID_DOCUMENT as varchar(50))+')'
					execute sp_executesql @sql
				End

			--Update du statut du document
			set @sql='update '+@TABLE_DOCUMENT+' set STATUT_'+@ABBREV_DOCUMENT+'=''ANNULE'''+
			',USER_ANNULATION_'+@ABBREV_DOCUMENT+'_ID='+cast(@ID_USER as varchar(MAX))+',DATE_ANNULATION_'+@ABBREV_DOCUMENT+'=getdate()'+
			' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
			set @sql=@sql+';select @n=@@ROWCOUNT'
			execute sp_executesql @sql,N'@n int output',@n output
			select 1 AS RESULTAT,@n
		End
	else
		select 0 as RESULTAT
End

END TRY

BEGIN CATCH  
	ROLLBACK TRANSACTION
	insert SQL_ERREUR (QUERY) values (@sql)
	select -99 as RESULTAT,ERROR_NUMBER() 
	RETURN
END CATCH;  

COMMIT TRANSACTION

END

GO
---------------------------------------------------------------------------------

ALTER PROCEDURE [dbo].[PRC_DEVALIDER_DOCUMENT] 
	@ID_TYPE_DOCUMENT numeric(18,0),@ID_SOCIETE numeric(18,0),@ID_DOCUMENT numeric(18,0),@ID_USER numeric(18,0)

AS
BEGIN
declare @sql nvarchar(4000)
declare @n int
declare @TABLE_DOCUMENT varchar(100)
declare @TABLE_DOCUMENT_UPDATE varchar(100)
declare @ABBREV_DOCUMENT varchar(10)
declare @ANNULER_STOCK char(1)
declare @ANNULER_SOLDE char(1)
declare @TIERS varchar(50)
declare @ID_TIERS numeric(18,0)
declare @NOM_TIERS varchar(100)
declare @DEBIT decimal(18,5)
declare @CREDIT decimal(18,5)
declare @NOM varchar(50)
declare @NUMERO varchar(50)
declare @DATE_DOCUMENT date
declare @TABLE_DOCUMENT_LIGNE varchar(100)
declare @TYPE_MOUVEMENT char(1)
declare @STATUT varchar(20)
declare @ID_DEVISE numeric(18,0)
declare @DEVISE varchar(50)
declare @LIBELLE_MOUVEMENT_REGLEMENT varchar(200)
declare @IS_DEVISE bit
declare @IS_REMBOURSEMENT bit
declare @REMBOURSEMENT bit 
declare @PAMP bit
declare @DOCUMENT_TIERS varchar(50)
declare @DOCUMENT_STOCK_TD bit 
declare @DOCUMENT_STOCK bit 
declare @STOCK_BRF bit

SET DATEFORMAT dmy

select @TABLE_DOCUMENT=TABLE_TD,@ABBREV_DOCUMENT=ABBREVIATION_TD,
@TABLE_DOCUMENT_LIGNE=TABLE_LIGNE_TD,@TYPE_MOUVEMENT=TYPE_MOUVEMENT_TD
,@IS_REMBOURSEMENT=IS_REMBOURSEMENT,@PAMP=PAMP_TD,@DOCUMENT_STOCK_TD=DOCUMENT_STOCK_TD,
@TABLE_DOCUMENT_UPDATE=TABLE_UPDATE_TD,@ANNULER_STOCK=ANNULER_STOCK,@STOCK_BRF=STOCK_BRF 
from TYPE_DOCUMENT where ID_TD=@ID_TYPE_DOCUMENT

BEGIN TRANSACTION

BEGIN TRY

set @sql='select  @STATUT=STATUT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
execute sp_executesql @sql,N'@STATUT varchar(20) output',@STATUT output

--Les documents encours sont annules sans aucunes actions sur le stock et les mouvements
if @ANNULER_STOCK is NULL
	Begin
		set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_SOURCE=''ENCOURS'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
				+' and TYPE_DT_SOURCE_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
				+' and DT_SOURCE_ID='+CAST(@ID_DOCUMENT as varchar(50))
		execute sp_executesql @sql

		set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_DESTINATION=''ENCOURS'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
				+' and TYPE_DT_DESTINATION_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
				+' and DT_DESTINATION_ID='+CAST(@ID_DOCUMENT as varchar(50))
		execute sp_executesql @sql

		set @sql='update '+@TABLE_DOCUMENT_UPDATE+' set STATUT_'+@ABBREV_DOCUMENT+'=''ENCOURS'''+
		',USER_MODIF_ID='+cast(@ID_USER as varchar(MAX))+',DATE_MODIF=getdate()'+
		' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(50))
		set @sql=@sql+';select @n=@@ROWCOUNT'
		execute sp_executesql @sql,N'@n int output',@n output

		select 1 AS RESULTAT,@n
	End
Else
Begin
	--Vrifier si le documents a t transfr vers un document non annul
	set @sql='select @n=ISNULL(count(1),0) from TRANSFERT_DOCUMENT where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
			+' and TYPE_DT_SOURCE_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
			+' and DT_SOURCE_ID='+CAST(@ID_DOCUMENT as varchar(50))
			+' and DT_STATUT_DESTINATION<>''ANNULE'''
	execute sp_executesql @sql,N'@n int output',@n output

	--Le document n'a pas t transfr vers un document non annul
	if @n=0
		Begin
			select @ANNULER_SOLDE=ANNULER_SOLDE,@ANNULER_STOCK=ANNULER_STOCK,@TIERS=TIERS_TD,@NOM=NOM_TD,@IS_DEVISE=IS_DEVISE from TYPE_DOCUMENT where ID_TD=@ID_TYPE_DOCUMENT
			--Le document est en devise diffrend de la devise de la socit
			if @IS_DEVISE=1
				Begin
					set @sql='select  @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+',@ID_TIERS='+@TIERS+'_'+@ABBREV_DOCUMENT+'_ID,@ID_DEVISE=DEVISE_'+@ABBREV_DOCUMENT+'_ID from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
					execute sp_executesql @sql,N'@ID_TIERS numeric(18,0) output,@NUMERO varchar(50) output,@ID_DEVISE numeric(18,0) output',@ID_TIERS output,@NUMERO output,@ID_DEVISE output
					select @DEVISE=LIBELLE_DEVISE from VUE_DEVISE where ID_DEVISE=@ID_DEVISE
				End
			Else
				Begin
					-- Les documents qui ont un client ou fournisseur
					if @TIERS IS NOT NULL
						Begin
							set @sql='select  @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+',@ID_TIERS='+@TIERS+'_'+@ABBREV_DOCUMENT+'_ID from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@ID_TIERS numeric(18,0) output,@NUMERO varchar(50) output',@ID_TIERS output,@NUMERO output
						End
					Else
					-- Les documents comme bon d'entre et sortie stock
						Begin
							set @sql='select  @NUMERO=NUMERO_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@ID_TIERS numeric(18,0) output,@NUMERO varchar(50) output',@ID_TIERS output,@NUMERO output
						End
				End

			if @DOCUMENT_STOCK_TD=1
					Begin
						set @sql='select @DOCUMENT_STOCK=MOUVEMENT_STOCK_DOCUMENT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT_UPDATE+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
						execute sp_executesql @sql,N'@DOCUMENT_STOCK bit output',@DOCUMENT_STOCK output
					End
			else
				set @DOCUMENT_STOCK=1

			--Test sur les documents qui touche le stock lors de leur annulation
			if @ANNULER_STOCK is NOT NULL and @DOCUMENT_STOCK=1
				Begin
					-- Bloquer le traitement quand il y a dj un inventaire en cours
					if exists (select 1 from INVENTAIRE_STOCK where SOCIETE_ID=@ID_SOCIETE and STATUT_IS='ENCOURS')
						Begin
							select -8 as RESULTAT
							ROLLBACK TRANSACTION
							RETURN
						End

						--Mise  jour du stock par dpt des article existant dans la table
						if @TIERS IS NOT NULL
							set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
							+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+ ' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
							+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'
						else
							set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
							+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+' update STOCK_DEPOT set QUANTITE_STOCK_SD=D.QUANTITE_STOCK_SD'+@ANNULER_STOCK+'C.QTE 
						from STOCK_DEPOT D inner join CTE C 
						on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SD_ID and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_SD_ID '+
						' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql

						--Insertion des articles du stock par dpt qui n'existent pas dans la table
						if @TIERS IS NOT NULL
							set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
							+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+ ' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
							+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'
						else
							set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
							+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+'insert STOCK_DEPOT (SOCIETE_ID,DEPOT_SD_ID,ARTICLE_SD_ID,QUANTITE_STOCK_SD)
						select '+CAST(@ID_SOCIETE as varchar(50))+',DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE from '
						+ ' CTE C where NOT EXISTS(select 1 from STOCK_DEPOT D where '
						+' C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_SD_ID and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SD_ID) '
						+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql

						-- Stock par proprit

						set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
						+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
						+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
						+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+' update STOCK_PROPRIETE set QUANTITE_STOCK_PROPRIETE=D.QUANTITE_STOCK_PROPRIETE'+@ANNULER_STOCK+'C.QTE 
						from STOCK_PROPRIETE D inner join CTE C '
						+' on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_PROPRIETE_ID and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_PROPRIETE_ID,0) '
						+' and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_PROPRIETE_ID,0) and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_PROPRIETE_ID '
						+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql
			
						set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
						+' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))
						+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
						+' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

						set @sql=@sql+'insert STOCK_PROPRIETE (SOCIETE_ID,TAILLE_PROPRIETE_ID,COULEUR_PROPRIETE_ID,ARTICLE_PROPRIETE_ID,DEPOT_PROPRIETE_ID,QUANTITE_STOCK_PROPRIETE) '
						+' select '+CAST(@ID_SOCIETE as varchar(50))+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,DEPOT_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE  from '
						+' CTE C where NOT EXISTS(select 1 from STOCK_PROPRIETE D where '
						+' ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_PROPRIETE_ID,0) and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_PROPRIETE_ID,0) and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_PROPRIETE_ID and C.DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=D.DEPOT_PROPRIETE_ID) '
						+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
						execute sp_executesql @sql

						set @sql='delete STOCK_PROPRIETE where QUANTITE_STOCK_PROPRIETE=0'
						execute sp_executesql @sql

						--Stock bon reception

						if @STOCK_BRF=1 
							Begin
								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) and BRF_'+@ABBREV_DOCUMENT+'_L_ID is not NULL'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+' update STOCK_BON_RECEPTION set QUANTITE_SBRF=D.QUANTITE_SBRF'+@ANNULER_STOCK+'C.QTE 
								from STOCK_BON_RECEPTION D inner join CTE C 
								on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID and C.BRF_'+@ABBREV_DOCUMENT+'_L_ID=D.BRF_SBRF_ID and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) 
								and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)'
								execute sp_executesql @sql

								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1) and BRF_'+@ABBREV_DOCUMENT+'_L_ID is not NULL'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,BRF_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+'insert STOCK_BON_RECEPTION (SOCIETE_ID,BRF_SBRF_ID,ARTICLE_SBRF_ID,TAILLE_ID,COULEUR_ID,QUANTITE_SBRF)
								select '+CAST(@ID_SOCIETE as varchar(50))+',BRF_'+@ABBREV_DOCUMENT+'_L_ID,ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE  from '
								+ ' CTE C where NOT EXISTS(select 1 from STOCK_BON_RECEPTION D where '
								+ ' C.BRF_'+@ABBREV_DOCUMENT+'_L_ID=D.BRF_SBRF_ID and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID '
								+ ' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)  ) '
								+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'
								execute sp_executesql @sql

								set @sql='delete STOCK_BON_RECEPTION where QUANTITE_SBRF=0'
								execute sp_executesql @sql
							End
						if @ID_TYPE_DOCUMENT=25
							Begin
								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+' update STOCK_BON_RECEPTION set QUANTITE_SBRF=D.QUANTITE_SBRF'+@ANNULER_STOCK+'C.QTE 
								from STOCK_BON_RECEPTION D inner join CTE C 
								on C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID and D.BRF_SBRF_ID='+CAST(@ID_DOCUMENT as varchar(50)) 
								+ ' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0) 
								and ISNULL(C.COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.COULEUR_ID,0)'
								execute sp_executesql @sql

								set @sql=';WITH CTE as (select ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,ISNULL(SUM(QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),0) as QTE,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID'
								+ ' from '+@TABLE_DOCUMENT_LIGNE+' L where '+@ABBREV_DOCUMENT+'_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0 '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
								+ ' Group by ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID)'

								set @sql=@sql+'insert STOCK_BON_RECEPTION (SOCIETE_ID,BRF_SBRF_ID,ARTICLE_SBRF_ID,TAILLE_ID,COULEUR_ID,QUANTITE_SBRF)
								select '+CAST(@ID_SOCIETE as varchar(50))+','+CAST(@ID_DOCUMENT as varchar(50))+',ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID,TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,'+@ANNULER_STOCK+'C.QTE  from '
								+' CTE C where NOT EXISTS(select 1 from STOCK_BON_RECEPTION D where '
								+' D.BRF_SBRF_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=D.ARTICLE_SBRF_ID '
								+' and ISNULL(C.TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,0)=ISNULL(D.TAILLE_ID,0)) '
								+' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=C.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1 and A.GESTION_STOCK_BRF=1)'
								execute sp_executesql @sql

								set @sql='delete STOCK_BON_RECEPTION where QUANTITE_SBRF=0'
								execute sp_executesql @sql
							End

						-- Mouvement stock (client/Fournisseur)
						if @TIERS IS NOT NULL
							Begin
								set @sql='insert MOUVEMENT_STOCK (SOCIETE_ID,TYPE_TIERS_MS,TIERS_MS_ID,NUMERO_TIERS_MS,NOM_TIERS_MS,
								DEPOT_MS_ID,NOM_DEPOT_MS,ARTICLE_MS_ID,ARTICLE_CODE_MS,LIBELLE_ARTICLE_MS,
								LIBELLE_MS,TYPE_DOCUMENT_MS,DOCUMENT_MS_ID,NUMERO_DOCUMENT_MS,QUANTITE_ENTREE_MS,
								QUANTITE_SORTIE_MS,PRIX_ACHAT_MS,NUMERO_SERIE_MS,DEVALIDATION_DOCUMENT_MS,
								ORDRE_DOCUMENT_LIGNE_MS,DATE_DOCUMENT_MS,TAILLE_MS_ID,NOM_TAILLE_MS,COULEUR_MS_ID,NOM_COULEUR_MS ' 
								if @ID_USER is not NULL
									set @sql=@sql+',USER_CREATION_ID) ' 
								else
									set @sql=@sql+') ' 

								set @sql=@sql+' select ' 
								+ CAST(@ID_SOCIETE as varchar(50)) +','''
								+@TIERS+''','
								+ 'E.'+@TIERS+'_' + @ABBREV_DOCUMENT + '_ID,'
								+ 'E.NUMERO_'+@TIERS+'_' + @ABBREV_DOCUMENT + ','
								+ 'E.NOM_'+@TIERS+'_' + @ABBREV_DOCUMENT + ','
								+ 'L.DEPOT_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.NOM_DEPOT_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.ARTICLE_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.ARTICLE_CODE_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.LIBELLE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,''DEVALIDATION '
								+ @NOM+' '+@NUMERO +''','
								+ CAST(@ID_TYPE_DOCUMENT as varchar(50)) +','
								+ CAST(@ID_DOCUMENT as varchar(50)) + ','
								+ 'E.NUMERO_' + @ABBREV_DOCUMENT + ','

								if @TYPE_MOUVEMENT='E'
									set @sql=@sql + '0,' + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'
								else
									set @sql=@sql + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0,'
								if @PAMP=1 
									set @sql=@sql+'L.PRIX_ACHAT_ARTICLE_HT_NET_DEVISE_'+@ABBREV_DOCUMENT+'_L,'
								else
									set @sql=@sql+'NULL,'
									
								set @sql=@sql+'NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L,1,'
								set @sql=@sql+'L.ORDRE_'+@ABBREV_DOCUMENT+'_L,E.DATE_'+@ABBREV_DOCUMENT
								set @sql=@sql+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,NOM_TAILLE_'+@ABBREV_DOCUMENT+'_L,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,NOM_COULEUR_'+@ABBREV_DOCUMENT+'_L'

								if @ID_USER is not NULL
									set @sql=@sql+','+CAST(@ID_USER as varchar(50)) 
								+ ' from ' + @TABLE_DOCUMENT_LIGNE + ' L'
								+ ' INNER JOIN ' + @TABLE_DOCUMENT + ' E'
								+ ' on E.ID_' + @ABBREV_DOCUMENT + '=L.' + @ABBREV_DOCUMENT + '_ID '
								+ ' where E.ID_' + @ABBREV_DOCUMENT + '=' + CAST(@ID_DOCUMENT as varchar(50)) 
								+ ' and ISNULL(L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0)>0 '
								+ ' and MOUVEMENT_STOCK_'+@ABBREV_DOCUMENT+'=0'
								--+ ' and (TYPE_DOCUMENT_SOURCE_'+@ABBREV_DOCUMENT+'_L IS NULL '
								--+ ' or exists (select 1 from TYPE_DOCUMENT where TYPE_DOCUMENT.ID_TD=L.TYPE_DOCUMENT_SOURCE_'+@ABBREV_DOCUMENT+'_L and TYPE_DOCUMENT.ANNULER_STOCK IS NULL)) '
								+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'

								execute sp_executesql @sql
							End
						Else
							--Mouvement pour les documents qui n'ont de tiers comme bon entre et sortie
							Begin
								set @sql='insert MOUVEMENT_STOCK (SOCIETE_ID,TYPE_TIERS_MS,
								DEPOT_MS_ID,NOM_DEPOT_MS,ARTICLE_MS_ID,ARTICLE_CODE_MS,LIBELLE_ARTICLE_MS,
								LIBELLE_MS,TYPE_DOCUMENT_MS,DOCUMENT_MS_ID,NUMERO_DOCUMENT_MS,QUANTITE_ENTREE_MS,
								QUANTITE_SORTIE_MS,NUMERO_SERIE_MS,DEVALIDATION_DOCUMENT_MS,
								ORDRE_DOCUMENT_LIGNE_MS,DATE_DOCUMENT_MS,TAILLE_MS_ID,NOM_TAILLE_MS,COULEUR_MS_ID,NOM_COULEUR_MS' 
								if @ID_USER is not NULL
									set @sql=@sql+',USER_CREATION_ID) ' 
								else
									set @sql=@sql+') ' 
								
								set @sql=@sql+' select ' 
								+ CAST(@ID_SOCIETE as varchar(50)) +','
								+ '''STOCK'','
								+ 'L.DEPOT_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.NOM_DEPOT_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.ARTICLE_' + @ABBREV_DOCUMENT + '_L_ID,'
								+ 'L.ARTICLE_CODE_' + @ABBREV_DOCUMENT + '_L,'
								+ 'L.LIBELLE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,''DEVALIDATION '
								+ @NOM+' '+@NUMERO +''','
								+ CAST(@ID_TYPE_DOCUMENT as varchar(50)) +','
								+ CAST(@ID_DOCUMENT as varchar(50)) + ','
								+ 'E.NUMERO_' + @ABBREV_DOCUMENT + ','

								if @TYPE_MOUVEMENT='E'
									set @sql=@sql + '0,' + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,'
								else
									set @sql=@sql + 'L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0,'
									
								set @sql=@sql+'NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L,1,'

								set @sql=@sql+'L.ORDRE_'+@ABBREV_DOCUMENT+'_L,E.DATE_'+@ABBREV_DOCUMENT
								
								set @sql=@sql+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID,NOM_TAILLE_'+@ABBREV_DOCUMENT+'_L,COULEUR_'+@ABBREV_DOCUMENT+'_L_ID,NOM_COULEUR_'+@ABBREV_DOCUMENT+'_L'

								if @ID_USER is not NULL
									set @sql=@sql+','+CAST(@ID_USER as varchar(50)) 

								+ ' from ' + @TABLE_DOCUMENT_LIGNE + ' L'
								+ ' INNER JOIN ' + @TABLE_DOCUMENT + ' E'
								+ ' on E.ID_' + @ABBREV_DOCUMENT + '=L.' + @ABBREV_DOCUMENT + '_ID '
								+ ' where E.ID_' + @ABBREV_DOCUMENT + '=' + CAST(@ID_DOCUMENT as varchar(50)) 
								+ ' and ISNULL(L.QTE_ARTICLE_' + @ABBREV_DOCUMENT + '_L,0)>0 '
								+ ' and exists(select 1 from ARTICLE A where A.ID_ARTICLE=L.ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID and A.GESTION_STOCK=1)'

								execute sp_executesql @sql
							End
						set @sql='Update MOUVEMENT_STOCK set DEVALIDATION_DOCUMENT_MS=1 where TYPE_DOCUMENT_MS='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
						+' and DOCUMENT_MS_ID='+CAST(@ID_DOCUMENT as varchar(50))+' and ANNULATION_DOCUMENT_MS=0 '
						execute sp_executesql @sql

				End
			--Affectation tiers
			if @ANNULER_SOLDE is NOT NULL
				Begin
					if @ANNULER_SOLDE='+'
						Begin
							if @IS_DEVISE=1
								set @sql='select @DEBIT=NET_PAYER_DEVISE_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							else
								set @sql='select @DEBIT=NET_PAYER_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))

							execute sp_executesql @sql,N'@DEBIT decimal(18,5) output,@DATE_DOCUMENT date output,@NOM_TIERS varchar(100) output',@DEBIT output,@DATE_DOCUMENT output,@NOM_TIERS output
							set @CREDIT=0
						End
					else
						Begin
							if @IS_DEVISE=1
								set @sql='select @CREDIT=NET_PAYER_DEVISE_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							else
								set @sql='select @CREDIT=NET_PAYER_'+@ABBREV_DOCUMENT+',@DATE_DOCUMENT=DATE_'+@ABBREV_DOCUMENT+',@NOM_TIERS=NOM_'+@TIERS+'_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@CREDIT decimal(18,5) output,@DATE_DOCUMENT date output,@NOM_TIERS varchar(100) output',@CREDIT output,@DATE_DOCUMENT output,@NOM_TIERS output
							set @DEBIT=0
						End
					if @TIERS is NOT NULL
						Begin
							set @sql='select @DOCUMENT_TIERS=DOCUMENT_'+@TIERS+'_'+@ABBREV_DOCUMENT 
								+' from '+@TABLE_DOCUMENT+' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
							execute sp_executesql @sql,N'@DOCUMENT_TIERS varchar(50) output',@DOCUMENT_TIERS output
						End
					Else
						set @DOCUMENT_TIERS=NULL

					--Mouvement tiers (client/fournisseur)
					if (@TIERS='CLIENT')
						Begin
							set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')+CASE WHEN @DOCUMENT_TIERS is not NULL THEN ' ['+@DOCUMENT_TIERS+']' ELSE '' END

							set @sql='insert MOUVEMENT_CLIENT (SOCIETE_ID,CLIENT_MC_ID,NOM_CLIENT_MC,LIBELLE_MC,TYPE_DOCUMENT_MC,
							DOCUMENT_MC_ID,NUMERO_DOCUMENT_MC,DEBIT_MC,CREDIT_MC,USER_CREATION_ID,DATE_DOCUMENT_MC) values ('+CAST(@ID_SOCIETE as varchar(50))+
							','+CAST(@ID_TIERS as varchar(50))+','''+replace(@NOM_TIERS,'''','''''')+''',''DEVALIDATION '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
							CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@DEBIT as varchar(50))+','+CAST(@CREDIT as varchar(50))+','+
							CAST(@ID_USER as varchar(50))+','''+CAST(@DATE_DOCUMENT as varchar(50))+''')'
							execute sp_executesql @sql

							--Marquer les mouvements d'annulation
							set @sql='update MOUVEMENT_CLIENT set DEVALIDE_MC=1 where '
							+' SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
							+' and DOCUMENT_MC_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+' and TYPE_DOCUMENT_MC='''+@ABBREV_DOCUMENT+''''
							execute sp_executesql @sql
						End
					else
						Begin
							set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')+CASE WHEN @DOCUMENT_TIERS is not NULL THEN ' ['+@DOCUMENT_TIERS+']' ELSE '' END

							set @sql='insert MOUVEMENT_FOURNISSEUR (SOCIETE_ID,FOURNISSEUR_MF_ID,NOM_FOURNISSEUR_MF,LIBELLE_MF,TYPE_DOCUMENT_MF,
							DOCUMENT_MF_ID,NUMERO_DOCUMENT_MF,DEBIT_MF,CREDIT_MF,USER_CREATION_ID,DATE_DOCUMENT_MF) values ('+CAST(@ID_SOCIETE as varchar(50))+
							','+CAST(@ID_TIERS as varchar(50))+','''+replace(@NOM_TIERS,'''','''''')+''',''DEVALIDATION '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
							CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@DEBIT as varchar(50))+','+CAST(@CREDIT as varchar(50))+','+
							CAST(@ID_USER as varchar(50))+','''+CAST(@DATE_DOCUMENT as varchar(50))+''')'
							execute sp_executesql @sql

							--Marquer les mouvements d'annulation
							set @sql='update MOUVEMENT_FOURNISSEUR set DEVALIDE_MF=1 where '
							+' SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
							+' and DOCUMENT_MF_ID='+CAST(@ID_DOCUMENT as varchar(50))
							+' and TYPE_DOCUMENT_MF='''+@ABBREV_DOCUMENT+''''
							execute sp_executesql @sql
						End

					--REMBOURSEMENT AVOIR
					if @IS_REMBOURSEMENT=1 
						Begin
							set @sql='select @REMBOURSEMENT=REMBOURSEMENT_'+@ABBREV_DOCUMENT+' from '+@TABLE_DOCUMENT
							+ ' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
							execute sp_executesql @sql,N'@REMBOURSEMENT bit output',@REMBOURSEMENT output
							if @REMBOURSEMENT=1 
								Begin
									if (@TIERS='CLIENT')
										Begin
											--Mouvement client
											set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')
											set @sql='insert MOUVEMENT_CLIENT (SOCIETE_ID,CLIENT_MC_ID,NOM_CLIENT_MC,LIBELLE_MC,TYPE_DOCUMENT_MC,
											DOCUMENT_MC_ID,NUMERO_DOCUMENT_MC,DEBIT_MC,CREDIT_MC,USER_CREATION_ID) values ('+CAST(@ID_SOCIETE as varchar(50))+
											','+CAST(@ID_TIERS as varchar(50))+','''+@NOM_TIERS+''',''DEVALIDATION REMBOURSEMENT '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
											CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@CREDIT as varchar(50))+','+CAST(@DEBIT as varchar(50))+','+CAST(@ID_USER as varchar(50))+')'
											execute sp_executesql @sql

											--Remettre les champs du remboursement  NULL et REMBOURSEMENT_AC=0
											set @sql='update '+@TABLE_DOCUMENT_UPDATE+' set '
												+'REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=0,MODE_REMBOURSEMENT_TYPE_'+@ABBREV_DOCUMENT+'_ID=NULL,DATE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL,DATE_ECHEANCE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL'
												+',NUM_DOCUMENT_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL,COMPTE_BANCAIRE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'_ID=NULL,RIB_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL'
												+',NOM_BANQUE_COMPTE_BANCAIRE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL,USER_REMBOUREMENT_'+@ABBREV_DOCUMENT+'=NULL,DATE_OPERATION_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL'
												+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
											execute sp_executesql @sql
										End
									else
										Begin
											--Mouvement fournisseur
											set @LIBELLE_MOUVEMENT_REGLEMENT=@NOM+' '+@NUMERO+' '+ISNULL('('+@DEVISE+')',' ')
											set @sql='insert MOUVEMENT_FOURNISSEUR (SOCIETE_ID,FOURNISSEUR_MF_ID,NOM_FOURNISSEUR_MF,LIBELLE_MF,TYPE_DOCUMENT_MF,
											DOCUMENT_MF_ID,NUMERO_DOCUMENT_MF,DEBIT_MF,CREDIT_MF,USER_CREATION_ID) values ('+CAST(@ID_SOCIETE as varchar(50))+
											','+CAST(@ID_TIERS as varchar(50))+','''+@NOM_TIERS+''',''DEVALIDATION REMBOURSEMENT '+@LIBELLE_MOUVEMENT_REGLEMENT+''','''+@ABBREV_DOCUMENT+''','+
											CAST(@ID_DOCUMENT as varchar(50))+','''+@NUMERO+''','+CAST(@CREDIT as varchar(50))+','+CAST(@DEBIT as varchar(50))+','+CAST(@ID_USER as varchar(50))+')'
											execute sp_executesql @sql

											--Remettre les champs du remboursement  NULL et REMBOURSEMENT_AF=0
											set @sql='update '+@TABLE_DOCUMENT_UPDATE+' set '
												+'REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=0,MODE_REMBOURSEMENT_TYPE_'+@ABBREV_DOCUMENT+'_ID=NULL,DATE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL,DATE_ECHEANCE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL'
												+',NUM_DOCUMENT_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL,BANQUE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'_ID=NULL'
												+',NOM_BANQUE_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL,USER_REMBOUREMENT_'+@ABBREV_DOCUMENT+'=NULL,DATE_OPERATION_REMBOURSEMENT_'+@ABBREV_DOCUMENT+'=NULL'
												+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
											execute sp_executesql @sql
										End
								End
						End
				End

			--Mise  jour de la table des transferts
			set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_SOURCE=''ENCOURS'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
					+' and TYPE_DT_SOURCE_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
					+' and DT_SOURCE_ID='+CAST(@ID_DOCUMENT as varchar(50))
			execute sp_executesql @sql

			set @sql='update TRANSFERT_DOCUMENT set DT_STATUT_DESTINATION=''ENCOURS'' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
					+' and TYPE_DT_DESTINATION_ID='+CAST(@ID_TYPE_DOCUMENT as varchar(50))
					+' and DT_DESTINATION_ID='+CAST(@ID_DOCUMENT as varchar(50))
			execute sp_executesql @sql

			--Annulation Rglement de BL
			if @ID_TYPE_DOCUMENT=6
				Begin
					set @sql='update REGLEMENT_CLIENT_BL set STATUT_RBC=''ANNULE'',
					USER_ANNULATION_RBC_ID='+CAST(@ID_USER as varchar(50))+',DATE_ANNULATION_RBC=getdate() 
					from REGLEMENT_CLIENT_BL R
					where exists(select 1 from REGLEMENT_CLIENT_BL_LIGNE L where R.ID_RBC=L.RBC_ID and L.BLC_RBC_L_ID='+CAST(@ID_DOCUMENT as varchar(50))+')'
					execute sp_executesql @sql
				End

			--Update du statut du document
			set @sql='update '+@TABLE_DOCUMENT+' set STATUT_'+@ABBREV_DOCUMENT+'=''ENCOURS'''+
			',USER_MODIF_ID='+cast(@ID_USER as varchar(MAX))+',DATE_MODIF=getdate()'+
			' where ID_'+@ABBREV_DOCUMENT+'='+cast(@ID_DOCUMENT as varchar(MAX))
			set @sql=@sql+';select @n=@@ROWCOUNT'
			execute sp_executesql @sql,N'@n int output',@n output
			select 1 AS RESULTAT,@n
		End
	else
		select 0 as RESULTAT
End

END TRY

BEGIN CATCH  
	ROLLBACK TRANSACTION
	insert SQL_ERREUR (QUERY) values (@sql)
	select -99 as RESULTAT,ERROR_NUMBER() 
	RETURN
END CATCH;  

COMMIT TRANSACTION

END

GO
--------------------------------------------------------------------------------

insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('2','TAILLE_DC_L_ID','TAILLE_DC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('2','NOM_TAILLE_DC_L','NOM_TAILLE_DC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('2','COULEUR_DC_L_ID','COULEUR_DC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('2','NOM_COULEUR_DC_L','NOM_COULEUR_DC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('4','TAILLE_BCC_L_ID','TAILLE_BCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('4','NOM_TAILLE_BCC_L','NOM_TAILLE_BCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('4','COULEUR_BCC_L_ID','COULEUR_BCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('4','NOM_COULEUR_BCC_L','NOM_COULEUR_BCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('6','TAILLE_BLC_L_ID','TAILLE_BLC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('6','NOM_TAILLE_BLC_L','NOM_TAILLE_BLC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('6','COULEUR_BLC_L_ID','COULEUR_BLC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('6','NOM_COULEUR_BLC_L','NOM_COULEUR_BLC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('8','TAILLE_BRC_L_ID','TAILLE_BRC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('8','NOM_TAILLE_BRC_L','NOM_TAILLE_BRC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('8','COULEUR_BRC_L_ID','COULEUR_BRC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('8','NOM_COULEUR_BRC_L','NOM_COULEUR_BRC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('10','TAILLE_FCC_L_ID','TAILLE_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('10','NOM_TAILLE_FCC_L','NOM_TAILLE_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('10','COULEUR_FCC_L_ID','COULEUR_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('10','NOM_COULEUR_FCC_L','NOM_COULEUR_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('12','TAILLE_AC_L_ID','TAILLE_AC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('12','NOM_TAILLE_AC_L','NOM_TAILLE_AC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('12','COULEUR_AC_L_ID','COULEUR_AC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('12','NOM_COULEUR_AC_L','NOM_COULEUR_AC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('14','TAILLE_DC_L_ID','TAILLE_BCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('14','NOM_TAILLE_DC_L','NOM_TAILLE_BCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('14','COULEUR_DC_L_ID','COULEUR_BCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('14','NOM_COULEUR_DC_L','NOM_COULEUR_BCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('16','TAILLE_DC_L_ID','TAILLE_BLC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('16','NOM_TAILLE_DC_L','NOM_TAILLE_BLC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('16','COULEUR_DC_L_ID','COULEUR_BLC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('16','NOM_COULEUR_DC_L','NOM_COULEUR_BLC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('18','TAILLE_DC_L_ID','TAILLE_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('18','NOM_TAILLE_DC_L','NOM_TAILLE_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('18','COULEUR_DC_L_ID','COULEUR_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('18','NOM_COULEUR_DC_L','NOM_COULEUR_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('20','TAILLE_BCC_L_ID','TAILLE_BLC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('20','NOM_TAILLE_BCC_L','NOM_TAILLE_BLC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('20','COULEUR_BCC_L_ID','COULEUR_BLC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('20','NOM_COULEUR_BCC_L','NOM_COULEUR_BLC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('22','TAILLE_BCC_L_ID','TAILLE_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('22','NOM_TAILLE_BCC_L','NOM_TAILLE_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('22','COULEUR_BCC_L_ID','COULEUR_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('22','NOM_COULEUR_BCC_L','NOM_COULEUR_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('24','TAILLE_BLC_L_ID','TAILLE_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('24','NOM_TAILLE_BLC_L','NOM_TAILLE_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('24','COULEUR_BLC_L_ID','COULEUR_FCC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('24','NOM_COULEUR_BLC_L','NOM_COULEUR_FCC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('26','TAILLE_BRC_L_ID','TAILLE_AC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('26','NOM_TAILLE_BRC_L','NOM_TAILLE_AC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('26','COULEUR_BRC_L_ID','COULEUR_AC_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('26','NOM_COULEUR_BRC_L','NOM_COULEUR_AC_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('28','TAILLE_BCF_L_ID','TAILLE_BRF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('28','NOM_TAILLE_BCF_L','NOM_TAILLE_BRF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('28','COULEUR_BCF_L_ID','COULEUR_BRF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('28','NOM_COULEUR_BCF_L','NOM_COULEUR_BRF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('30','TAILLE_BCF_L_ID','TAILLE_FCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('30','NOM_TAILLE_BCF_L','NOM_TAILLE_FCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('30','COULEUR_BCF_L_ID','COULEUR_FCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('30','NOM_COULEUR_BCF_L','NOM_COULEUR_FCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('32','TAILLE_BRF_L_ID','TAILLE_FCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('32','NOM_TAILLE_BRF_L','NOM_TAILLE_FCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('32','COULEUR_BRF_L_ID','COULEUR_FCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('32','NOM_COULEUR_BRF_L','NOM_COULEUR_FCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('34','TAILLE_BTF_L_ID','TAILLE_AF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('34','NOM_TAILLE_BTF_L','NOM_TAILLE_AF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('34','COULEUR_BTF_L_ID','COULEUR_AF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('34','NOM_COULEUR_BTF_L','NOM_COULEUR_AF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('36','TAILLE_BCF_L_ID','TAILLE_BCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('36','NOM_TAILLE_BCF_L','NOM_TAILLE_BCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('36','COULEUR_BCF_L_ID','COULEUR_BCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('36','NOM_COULEUR_BCF_L','NOM_COULEUR_BCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('38','TAILLE_BRF_L_ID','TAILLE_BRF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('38','NOM_TAILLE_BRF_L','NOM_TAILLE_BRF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('38','COULEUR_BRF_L_ID','COULEUR_BRF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('38','NOM_COULEUR_BRF_L','NOM_COULEUR_BRF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('40','TAILLE_FCF_L_ID','TAILLE_FCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('40','NOM_TAILLE_FCF_L','NOM_TAILLE_FCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('40','COULEUR_FCF_L_ID','COULEUR_FCF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('40','NOM_COULEUR_FCF_L','NOM_COULEUR_FCF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('42','TAILLE_BTF_L_ID','TAILLE_BTF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('42','NOM_TAILLE_BTF_L','NOM_TAILLE_BTF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('42','COULEUR_BTF_L_ID','COULEUR_BTF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('42','NOM_COULEUR_BTF_L','NOM_COULEUR_BTF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('44','TAILLE_AF_L_ID','TAILLE_AF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('44','NOM_TAILLE_AF_L','NOM_TAILLE_AF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('44','COULEUR_AF_L_ID','COULEUR_AF_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('44','NOM_COULEUR_AF_L','NOM_COULEUR_AF_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('50','TAILLE_ES_L_ID','TAILLE_ES_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('50','NOM_TAILLE_ES_L','NOM_TAILLE_ES_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('50','COULEUR_ES_L_ID','COULEUR_ES_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('50','NOM_COULEUR_ES_L','NOM_COULEUR_ES_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('52','TAILLE_SS_L_ID','TAILLE_SS_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('52','NOM_TAILLE_SS_L','NOM_TAILLE_SS_L')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('52','COULEUR_SS_L_ID','COULEUR_SS_L_ID')
insert TRANSFERT_DOCUMENT_CONFIG_CHAMPS  (TRANSFERT_ID,CHAMPS_SOURCE,CHAMPS_DESTINATION) values ('52','NOM_COULEUR_SS_L','NOM_COULEUR_SS_L')

GO

------------------------------------------------------------------------------
CREATE VIEW [dbo].[VUE_ARTICLE_PROPRIETE]
AS
SELECT dbo.ARTICLE.ID_ARTICLE, dbo.ARTICLE.SOCIETE_ID, dbo.ARTICLE.CODE_ARTICLE, dbo.ARTICLE.LIBELLE_ARTICLE, dbo.ARTICLE.LIBELLE_ARTICLE_LANGUE_2, dbo.ARTICLE.DEPOT_ARTICLE_ID, 
dbo.ARTICLE.FAMILLE_ARTICLE_ID, dbo.ARTICLE.TVA_ARTICLE_ID, dbo.ARTICLE.PRIX_ACHAT_ARTICLE_HT, dbo.ARTICLE.PRIX_ACHAT_ARTICLE_TTC, dbo.ARTICLE.MARGE_ARTICLE, ARTICLE.PRIX_VENTE_ARTICLE_HT as PRIX_VENTE_ARTICLE_HT, 
dbo.ARTICLE.PRIX_VENTE_ARTICLE_TTC as PRIX_VENTE_ARTICLE_TTC, dbo.ARTICLE.GESTION_STOCK, CASE WHEN ARTICLE_PROPRIETE.TAILLE_ID is not NULL or ARTICLE_PROPRIETE.COULEUR_ID is not NULL THEN ISNULL(STOCK_PROPRIETE.QUANTITE_STOCK_PROPRIETE,0) ELSE ARTICLE.QUANTITE_STOCK END as QUANTITE_STOCK, dbo.ARTICLE.PAMP_ARTICLE, dbo.ARTICLE.QUANTITE_STOCK_MIN, dbo.ARTICLE.QUANTITE_STOCK_MAX, 
dbo.ARTICLE.CODE_BARRE_ARTICLE, dbo.ARTICLE.MARQUE_ARTICLE_ID, dbo.ARTICLE.CATEGORIE_ARTICLE_ID, dbo.ARTICLE.UNITE_ARTICLE_ID, dbo.UNITE_ARTICLE.NOM_UNITE_ARTICLE, dbo.ARTICLE.GARANTIE_MOIS, 
dbo.ARTICLE.POIDS_NET_KG, dbo.ARTICLE.POIDS_BRUT_KG, dbo.ARTICLE.BLOQUE_ARTICLE, dbo.ARTICLE.IMAGE_ARTICLE, dbo.ARTICLE.OBSERVATION, dbo.ARTICLE.USER_CREATION_ID, dbo.ARTICLE.DATE_CREATION, 
dbo.ARTICLE.USER_MODIF_ID, dbo.ARTICLE.DATE_MODIF, dbo.FAMILLE_ARTICLE.NOM_FAMILLE_ARTICLE, dbo.TVA_ARTICLE.TAUX_TVA_ARTICLE, dbo.MARQUE_ARTICLE.NOM_MARQUE_ARTICLE, 
dbo.CATEGORIE_ARTICLE.NOM_CATEGORIE_ARTICLE, dbo.DEPOT.NOM_DEPOT, dbo.ARTICLE.TYPE_CALCUL, dbo.ARTICLE.DIVERS_ARTICLE, dbo.ARTICLE.FODEC_ACHAT_ARTICLE, dbo.ARTICLE.FODEC_VENTE_ARTICLE, 
dbo.ARTICLE.QUANTITE_ARTICLE, dbo.ARTICLE.TPE_ACHAT_ARTICLE, dbo.ARTICLE.TPE_VENTE_ARTICLE, dbo.ARTICLE.BALANCE_ARTICLE, dbo.ARTICLE.PRIX_VENTE_PUBLIC_ARTICLE, 
dbo.ARTICLE.NUMERO_SERIE_OBLIGATOIRE_ARTICLE, CAST(0 AS bit) AS SELECTION_ARTICLE, dbo.ARTICLE.CHARGE_ARTICLE, ISNULL(dbo.ARTICLE.PRIX_ACHAT_ARTICLE_HT, 0) + ISNULL(dbo.ARTICLE.CHARGE_ARTICLE, 
0) AS PRIX_REVIENT_ARTICLE, dbo.ARTICLE.GESTION_STOCK_BRF, dbo.ARTICLE.TYPE_DROIT_CONSOMMATION_ARTICLE, dbo.ARTICLE.VALEUR_DROIT_CONSOMMATION_ARTICLE, 
dbo.ARTICLE.DROIT_CONSOMMATION_VENTE_ARTICLE, dbo.ARTICLE.DROIT_CONSOMMATION_ACHAT_ARTICLE,
ARTICLE_PROPRIETE.TAILLE_ID,ARTICLE_PROPRIETE.COULEUR_ID,
TAILLE.NOM_TAILLE,COULEUR.NOM_COULEUR
FROM dbo.ARTICLE 
LEFT JOIN ARTICLE_PROPRIETE on ARTICLE_PROPRIETE.ARTICLE_ID=ARTICLE.ID_ARTICLE
LEFT JOIN TAILLE on TAILLE.ID_TAILLE=ARTICLE_PROPRIETE.TAILLE_ID
LEFT JOIN COULEUR on COULEUR.ID_COULEUR=ARTICLE_PROPRIETE.COULEUR_ID
LEFT JOIN STOCK_PROPRIETE on STOCK_PROPRIETE.ARTICLE_PROPRIETE_ID=ARTICLE.ID_ARTICLE 
and STOCK_PROPRIETE.TAILLE_PROPRIETE_ID=TAILLE.ID_TAILLE and STOCK_PROPRIETE.COULEUR_PROPRIETE_ID=COULEUR.ID_COULEUR 
LEFT OUTER JOIN dbo.FAMILLE_ARTICLE ON dbo.ARTICLE.FAMILLE_ARTICLE_ID = dbo.FAMILLE_ARTICLE.ID_FAMILLE_ARTICLE 
LEFT OUTER JOIN dbo.TVA_ARTICLE ON dbo.ARTICLE.TVA_ARTICLE_ID = dbo.TVA_ARTICLE.ID_TVA_ARTICLE 
LEFT OUTER JOIN dbo.MARQUE_ARTICLE ON dbo.ARTICLE.MARQUE_ARTICLE_ID = dbo.MARQUE_ARTICLE.ID_MARQUE_ARTICLE
LEFT OUTER JOIN dbo.CATEGORIE_ARTICLE ON dbo.ARTICLE.CATEGORIE_ARTICLE_ID = dbo.CATEGORIE_ARTICLE.ID_CATEGORIE_ARTICLE 
LEFT OUTER JOIN dbo.UNITE_ARTICLE ON dbo.ARTICLE.UNITE_ARTICLE_ID = dbo.UNITE_ARTICLE.ID_UNITE_ARTICLE 
LEFT OUTER JOIN dbo.DEPOT ON dbo.ARTICLE.DEPOT_ARTICLE_ID = dbo.DEPOT.ID_DEPOT
WHERE        (dbo.ARTICLE.DIVERS_ARTICLE = 0)
GO


-------------------------------------------------------------------------


update GRID set TABLE_GRID='VUE_ARTICLE_PROPRIETE',TABLE_GRID_UPDATE='VUE_ARTICLE_PROPRIETE' where ID_GRID=4
GO

insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) values (1767,'4','NOM_TAILLE','TAILLE',NULL,NULL,'100',NULL,'50','1','1','1','0','0','0','0','0','0','0','9','TEXT','C')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE) values (1768,'4','NOM_COULEUR','COULEUR',NULL,NULL,'100',NULL,'50','1','1','1','0','0','0','0','0','0','0','10','TEXT','C')


insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,
ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,
VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values
(1797,'4','TAILLE_ID','TAILLE_ID',NULL,NULL,'0',NULL,'0','1','0','1','0','0','0','0','0','0','0','12','NUMERIC','L')
insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,
ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,
VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values
(1798,'4','COULEUR_ID','COULEUR_ID',NULL,NULL,'0',NULL,'0','1','0','1','0','0','0','0','0','0','0','13','NUMERIC','L')


GO

-------------------------------------------------------------------------------

--create procedure PRC_PROPRIETE_INSERT 
--@ID_ARTICLE numeric(18,0),
--@ID_TAILLE numeric(18,0),
--@ID_COULEUR numeric(18,0),
--@CODE_BARRE varchar(50),
--@BLOQUE bit
--as

--if exists (select 1 from ARTICLE_PROPRIETE where ARTICLE_ID=@ID_ARTICLE and TAILLE_ID=@ID_TAILLE and COULEUR_ID=@ID_COULEUR)
--	select -1 as RESULTAT
--else
--	Begin
--		insert ARTICLE_PROPRIETE (ARTICLE_ID,TAILLE_ID,COULEUR_ID,CODE_BARRE_PROPRIETE,BLOQUE_PROPRIETE)
--		select @ID_ARTICLE,@ID_TAILLE,@ID_COULEUR,@CODE_BARRE,@BLOQUE
--		select @@ROWCOUNT as RESULTAT
--	End

--GO

-------------------------------------------------------------------------------
IF OBJECT_ID('PRC_PROPRIETE_INSERT') IS NOT NULL  
    DROP PROCEDURE PRC_PROPRIETE_INSERT;  
GO
create procedure PRC_PROPRIETE_INSERT 
@ID_ARTICLE numeric(18,0),
@ID_TAILLE nvarchar(MAX),
@ID_COULEUR varchar(MAX)
as

declare @sql nvarchar(MAX)
declare @ID_SUIV_COULEUR nvarchar(MAX)
declare @ID_SUIV_TAILLE nvarchar(MAX)
declare @ID_TAILLE_INITIAL nvarchar(MAX)
declare @n int


BEGIN TRY

set @sql='select @n=isnull(count(1),0) from ARTICLE_PROPRIETE
where ARTICLE_ID='+CAST(@ID_ARTICLE as varchar(50))+
' and TAILLE_ID in ('+@ID_TAILLE+') and COULEUR_ID in ('+@ID_COULEUR+')'
execute sp_executesql @sql,N'@n int output',@n output
if @n>0
Begin
	select -1 as RESULTAT
	RETURN
End

if not exists (select 1 from ARTICLE_PROPRIETE where ARTICLE_ID=@ID_ARTICLE)
and exists (select 1 from ARTICLE where ID_ARTICLE=@ID_ARTICLE and QUANTITE_STOCK<>0)
Begin
	select -2 as RESULTAT
	RETURN
End


set @ID_TAILLE_INITIAL=@ID_TAILLE
set @sql='insert ARTICLE_PROPRIETE (ARTICLE_ID,TAILLE_ID,COULEUR_ID) '

WHILE (@ID_COULEUR<>'' and CHARINDEX(',', @ID_COULEUR)>0 )
Begin
	set @ID_TAILLE=@ID_TAILLE_INITIAL
	set @ID_SUIV_COULEUR=substring(@ID_COULEUR,1,CHARINDEX(',', @ID_COULEUR)-1)
	set @ID_COULEUR=substring(@ID_COULEUR,CHARINDEX(',', @ID_COULEUR)+1,len(@ID_COULEUR))
	WHILE (@ID_TAILLE<>'' and CHARINDEX(',', @ID_TAILLE)>0 )
	Begin
		set @ID_SUIV_TAILLE=substring(@ID_TAILLE,1,CHARINDEX(',', @ID_TAILLE)-1)
		set @ID_TAILLE=substring(@ID_TAILLE,CHARINDEX(',', @ID_TAILLE)+1,len(@ID_TAILLE))
		set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_SUIV_TAILLE+''','''+@ID_SUIV_COULEUR+''''	
		set @sql=@sql+' UNION ALL '	
	End	
	set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_TAILLE+''','''+@ID_SUIV_COULEUR+''''	
	set @sql=@sql+' UNION ALL '	
End

set @ID_TAILLE=@ID_TAILLE_INITIAL
WHILE (@ID_TAILLE<>'' and CHARINDEX(',', @ID_TAILLE)>0 )
Begin
	set @ID_SUIV_TAILLE=substring(@ID_TAILLE,1,CHARINDEX(',', @ID_TAILLE)-1)
	set @ID_TAILLE=substring(@ID_TAILLE,CHARINDEX(',', @ID_TAILLE)+1,len(@ID_TAILLE))

	set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_SUIV_TAILLE+''','''+@ID_COULEUR+''''	
	set @sql=@sql+' UNION ALL '	
End	

set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_TAILLE+''','''+@ID_COULEUR+''''	

set @sql=@sql+';select @n=@@ROWCOUNT'
execute sp_executesql @sql,N'@n int output',@n output

select @n as RESULTAT

END TRY

BEGIN CATCH  
	insert SQL_ERREUR (QUERY) values (@sql)
	select -99 as RESULTAT,ERROR_NUMBER() 
	RETURN
END CATCH;  

GO

-------------------------------------------------------------------------------
IF OBJECT_ID('PRC_PROPRIETE_INSERT_SANS_COULEUR') IS NOT NULL  
    DROP PROCEDURE PRC_PROPRIETE_INSERT_SANS_COULEUR;  
GO
create procedure PRC_PROPRIETE_INSERT_SANS_COULEUR
@ID_ARTICLE numeric(18,0),
@ID_TAILLE nvarchar(MAX)
as

declare @sql nvarchar(MAX)
declare @ID_SUIV_TAILLE nvarchar(MAX)
declare @n int

BEGIN TRY

--set @sql='select @n=count(1) from ARTICLE_PROPRIETE
--where ARTICLE_ID='+CAST(@ID_ARTICLE as varchar(50))+
--' and COULEUR_ID is not NULL '
--execute sp_executesql @sql,N'@n int output',@n output
--if @n>0
--	Begin
--		select -1 as RESULTAT
--		RETURN
--	End

set @sql='select @n=count(1) from ARTICLE_PROPRIETE
where ARTICLE_ID='+CAST(@ID_ARTICLE as varchar(50))+
' and TAILLE_ID in ('+@ID_TAILLE+') '
execute sp_executesql @sql,N'@n int output',@n output
if @n>0
	Begin
		select -1 as RESULTAT
		RETURN
	End

set @sql='insert ARTICLE_PROPRIETE (ARTICLE_ID,TAILLE_ID) '

WHILE (@ID_TAILLE<>'' and CHARINDEX(',', @ID_TAILLE)>0 )
Begin
	set @ID_SUIV_TAILLE=substring(@ID_TAILLE,1,CHARINDEX(',', @ID_TAILLE)-1)
	set @ID_TAILLE=substring(@ID_TAILLE,CHARINDEX(',', @ID_TAILLE)+1,len(@ID_TAILLE))
	set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_SUIV_TAILLE+''''	
	set @sql=@sql+' UNION ALL '	
End	

set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_TAILLE+''''

set @sql=@sql+';select @n=@@ROWCOUNT'
execute sp_executesql @sql,N'@n int output',@n output

select @n as RESULTAT

END TRY

BEGIN CATCH  
	insert SQL_ERREUR (QUERY) values (@sql)
	select -99 as RESULTAT,ERROR_NUMBER() 
	RETURN
END CATCH;  


GO
-------------------------------------------------------------------------
IF OBJECT_ID('PRC_PROPRIETE_INSERT_SANS_TAILLE') IS NOT NULL  
    DROP PROCEDURE PRC_PROPRIETE_INSERT_SANS_TAILLE;  
GO
create procedure PRC_PROPRIETE_INSERT_SANS_TAILLE
@ID_ARTICLE numeric(18,0),
@ID_COULEUR nvarchar(MAX)
as

declare @sql nvarchar(MAX)
declare @ID_SUIV_COULEUR nvarchar(MAX)
declare @n int


BEGIN TRY

--set @sql='select @n=count(1) from ARTICLE_PROPRIETE
--where ARTICLE_ID='+CAST(@ID_ARTICLE as varchar(50))+
--' and TAILLE_ID is not NULL '
--execute sp_executesql @sql,N'@n int output',@n output
--if @n>0
--	Begin
--		select -1 as RESULTAT
--		RETURN
--	End

set @sql='select @n=count(1) from ARTICLE_PROPRIETE
where ARTICLE_ID='+CAST(@ID_ARTICLE as varchar(50))+
' and COULEUR_ID in ('+@ID_COULEUR+') '
execute sp_executesql @sql,N'@n int output',@n output
if @n>0
	Begin
		select -1 as RESULTAT
		RETURN
	End

set @sql='insert ARTICLE_PROPRIETE (ARTICLE_ID,COULEUR_ID) '

WHILE (@ID_COULEUR<>'' and CHARINDEX(',', @ID_COULEUR)>0 )
Begin
	set @ID_SUIV_COULEUR=substring(@ID_COULEUR,1,CHARINDEX(',', @ID_COULEUR)-1)
	set @ID_COULEUR=substring(@ID_COULEUR,CHARINDEX(',', @ID_COULEUR)+1,len(@ID_COULEUR))
	set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_SUIV_COULEUR+''''	
	set @sql=@sql+' UNION ALL '	
End	

set @sql=@sql+'select '+CAST(@ID_ARTICLE as varchar(50))+','''+@ID_COULEUR+''''

set @sql=@sql+';select @n=@@ROWCOUNT'
execute sp_executesql @sql,N'@n int output',@n output

select @n as RESULTAT


END TRY

BEGIN CATCH  
	insert SQL_ERREUR (QUERY) values (@sql)
	select -99 as RESULTAT,ERROR_NUMBER() 
	RETURN
END CATCH;  

GO

--------------------------------------------------------------------------
create procedure PRC_PROPRIETE_UPDATE 
@ID_PROPRIETE numeric(18,0),
@CODE_BARRE varchar(50),
@BLOQUE bit
as

update ARTICLE_PROPRIETE set CODE_BARRE_PROPRIETE=@CODE_BARRE,BLOQUE_PROPRIETE=@BLOQUE
where ID_PROPRIETE=@ID_PROPRIETE

select @@ROWCOUNT as RESULTAT

GO

------------------------------------------------------------------------------------------


create procedure PRC_PROPRIETE_UPDATE_BLOQUE
@ID_PROPRIETE numeric(18,0),
@BLOQUE bit
as

update ARTICLE_PROPRIETE set BLOQUE_PROPRIETE=@BLOQUE
where ID_PROPRIETE=@ID_PROPRIETE

select @@ROWCOUNT as RESULTAT

GO

-------------------------------------------------------------------------------

create procedure PRC_PROPRIETE_DELETE
@ID_PROPRIETE numeric(18,0)
as

Begin TRY

delete ARTICLE_PROPRIETE where ID_PROPRIETE=@ID_PROPRIETE
select @@ROWCOUNT as RESULTAT

END TRY

BEGIN CATCH  
	select -99 as RESULTAT
	RETURN
END CATCH; 

GO

-----------------------------------------------------------------------------------------

create procedure PRC_PROPRIETE_SELECT
@ID_ARTICLE numeric(18,0)

as

select 
ID_PROPRIETE,
ID_TAILLE,
NOM_TAILLE,
ID_COULEUR,
NOM_COULEUR,
CODE_BARRE_PROPRIETE,
BLOQUE_PROPRIETE
from ARTICLE_PROPRIETE P
left join TAILLE T on T.ID_TAILLE=P.TAILLE_ID
left join COULEUR C on C.ID_COULEUR=P.COULEUR_ID
where 
ARTICLE_ID=@ID_ARTICLE

order by ID_PROPRIETE DESC

GO
-----------------------------------------------------------------------------




CREATE procedure [dbo].[GET_TAILLE_LIST] @ID_SOCIETE numeric(18,0)
as


select ID_TAILLE, NOM_TAILLE AS[TAILLE] from TAILLE where SOCIETE_ID = @ID_SOCIETE and BLOQUE_TAILLE=0 ORDER BY ORDRE_TAILLE ASC

GO


CREATE procedure [dbo].[GET_COULEUR_LIST] @ID_SOCIETE numeric(18,0)
as


select ID_COULEUR AS [ID_COULEUR],NOM_COULEUR AS [COULEUR] from COULEUR where SOCIETE_ID= @ID_SOCIETE and BLOQUE_COULEUR=0

GO

-----------------------------------------------------------------------------

update GRID_COLONNE set ORDRE_COLONNE=ORDRE_COLONNE+1 where GRID_ID=4
GO


insert GRID_COLONNE  (ID_GRID_COLONNE,GRID_ID,CHAMPS_COLONNE,NOM_COLONNE,LISTE_COLONNE,VALEUR_DEFAUT_COLONNE,LARGEUR_COLONNE,CHECK_COLONNE,LONGUEUR_TYPE_COLONNE,
ACTIF_COLONNE,VISIBLE_COLONNE,READONLY_COLONNE,MONNAIE_COLONNE,GRID_LISTE_COLONNE,CALCULE_COLONNE,TRONQUER_ZERO_COLONNE,ZERO_VIDE_COLONNE,ACCEPTER_NULL_COLONNE,
VISIBLE_DEFAUT_COLONNE,ORDRE_COLONNE,TYPE_COLONNE,ALIGN_COLONNE)
values
(1769,'4','ROW_NUMBER() OVER(ORDER BY ID_ARTICLE)','ROW_INDEX',NULL,NULL,'0',NULL,'0','1','0','1','0','0','0','0','0','0','0','0','NUMERIC','L')
GO

-----------------------------------------------------------------------------


ALTER PROCEDURE [dbo].[PRC_MAJ_DOCUMENT_LIGNE_ARTICLE]
	@ID_TYPE_DOCUMENT numeric(18,0),
	@ID_DOCUMENT numeric(18,0),
	@ID_DOCUMENT_LIGNE numeric(18,0),
	@ID_ARTICLE numeric(18,0),
	@ID_TAILLE numeric(18,0),
	@ID_COULEUR numeric(18,0),
	@ENVOI_RESULTAT bit=1,
	@TRANSACT bit=1,
	@RESULTAT int=NULL output
AS
BEGIN
declare @sql  nvarchar(4000)
declare @n int
declare @EXONERATION_TAXE bit
declare @TABLE_ARTICLE varchar(50)
declare @TAUX_REMISE_CLIENT decimal(5,2)
declare @PRIX_ACHAT bit
declare @ID_SOCIETE numeric(18,0)
declare	@TABLE varchar(50)
declare	@TABLE_LIGNE varchar(50)
declare	@ABBREV_DOCUMENT varchar(10)
declare @STATUT_NS varchar(50)=NULL
declare	@VA varchar(50)
declare	@ID_TIERS numeric(18,0)
declare	@ID_DEVISE_SOCIETE numeric(18,0)
declare	@ID_DEVISE_DOCUMENT numeric(18,0)
declare @STOCK_BRF bit
declare @FODEC decimal(4,2)
declare @TPE decimal(4,2)
declare @NOM_TAILLE nvarchar(200)
declare @NOM_COULEUR nvarchar(200)
select @FODEC=FODEC,@TPE=TPE from PARAMETRES
select @TABLE=TABLE_UPDATE_TD,@TABLE_LIGNE=TABLE_LIGNE_UPDATE_TD,@ABBREV_DOCUMENT=ABBREVIATION_TD,@VA=TYPE_VA_TD,
@STATUT_NS=STATUT_NUMERO_SERIE_TD,@STOCK_BRF=STOCK_BRF
from TYPE_DOCUMENT where ID_TD=@ID_TYPE_DOCUMENT
select @NOM_TAILLE=NOM_TAILLE from TAILLE where ID_TAILLE=@ID_TAILLE
select @NOM_COULEUR=NOM_COULEUR from COULEUR where ID_COULEUR=@ID_COULEUR
if @TRANSACT=1 Begin Transaction
BEGIN TRY
if @VA='VENTE'
	set @sql='select  @ID_SOCIETE=SOCIETE_ID,@ID_TIERS=CLIENT_'+@ABBREV_DOCUMENT+'_ID,@ID_DEVISE_DOCUMENT=DEVISE_'+@ABBREV_DOCUMENT+'_ID from '+@TABLE+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
else
	set @sql='select  @ID_SOCIETE=SOCIETE_ID,@ID_TIERS=FOURNISSEUR_'+@ABBREV_DOCUMENT+'_ID,@ID_DEVISE_DOCUMENT=DEVISE_'+@ABBREV_DOCUMENT+'_ID  from '+@TABLE+' where ID_'+@ABBREV_DOCUMENT+'='+CAST(@ID_DOCUMENT as varchar(50))
execute sp_executesql @sql,N'@ID_SOCIETE numeric(18,0) output,@ID_TIERS numeric(18,0) output,@ID_DEVISE_DOCUMENT numeric(18,0) output',
@ID_SOCIETE output,@ID_TIERS output,@ID_DEVISE_DOCUMENT output
select @PRIX_ACHAT=PRIX_ACHAT_SOCIETE,@ID_DEVISE_SOCIETE=DEVISE_SOCIETE_ID from SOCIETE where ID_SOCIETE=@ID_SOCIETE
if @VA='VENTE'
	select @EXONERATION_TAXE=EXONERATION_TAXE_CLIENT,@TAUX_REMISE_CLIENT=TAUX_REMISE_CLIENT from CLIENT where ID_CLIENT=@ID_TIERS
else
	select @EXONERATION_TAXE=EXONERATION_TAXE_FOURNISSEUR from FOURNISSEUR where ID_FOURNISSEUR=@ID_TIERS
if @ID_DEVISE_SOCIETE=@ID_DEVISE_DOCUMENT
	set @TABLE_ARTICLE='VUE_ARTICLE'
else
	set @TABLE_ARTICLE='VUE_ARTICLE_DEVISE'
set @sql='update '+ @TABLE_LIGNE+' set
ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=A.ID_ARTICLE,
ARTICLE_CODE_'+@ABBREV_DOCUMENT+'_L=A.CODE_ARTICLE,
LIBELLE_ARTICLE_'+@ABBREV_DOCUMENT+'_L=A.LIBELLE_ARTICLE,'
if @VA='VENTE' OR (@VA='ACHAT' and @PRIX_ACHAT=1)
	set @sql=@sql+'PRIX_'+@VA+'_ARTICLE_HT_BRUT_'+@ABBREV_DOCUMENT+'_L=A.PRIX_'+@VA+'_ARTICLE_HT,'
Else
	set @sql=@sql++'PRIX_'+@VA+'_ARTICLE_HT_BRUT_'+@ABBREV_DOCUMENT+'_L=NULL,'
set @sql=@sql+'TVA_ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=CASE WHEN '+CAST(@EXONERATION_TAXE as varchar(50))+'=0 THEN A.TVA_ARTICLE_ID ELSE NULL END,
TAUX_ARTICLE_TVA_'+@ABBREV_DOCUMENT+'_L=CASE WHEN '+CAST(@EXONERATION_TAXE as varchar(50))+'=0 THEN A.TAUX_TVA_ARTICLE ELSE NULL END,
TAUX_ARTICLE_TVA_ORIGINE_'+@ABBREV_DOCUMENT+'_L=A.TAUX_TVA_ARTICLE,
UNITE_ARTICLE_'+@ABBREV_DOCUMENT+'_L_ID=A.UNITE_ARTICLE_ID,
NOM_UNITE_ARTICLE_'+@ABBREV_DOCUMENT+'_L=A.NOM_UNITE_ARTICLE,
DEPOT_'+@ABBREV_DOCUMENT+'_L_ID=A.DEPOT_ARTICLE_ID,
NOM_DEPOT_'+@ABBREV_DOCUMENT+'_L=A.NOM_DEPOT,'
if @TAUX_REMISE_CLIENT is not NULL
	set @sql=@sql+'TAUX_REMISE_ARTICLE_'+@ABBREV_DOCUMENT+'_L='+CAST(@TAUX_REMISE_CLIENT as varchar(50))+','
else
	set @sql=@sql+'TAUX_REMISE_ARTICLE_'+@ABBREV_DOCUMENT+'_L=NULL,'
set @sql=@sql+'QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L=ISNULL(A.QUANTITE_ARTICLE,QTE_ARTICLE_'+@ABBREV_DOCUMENT+'_L),'
set @sql=@sql+'MONTANT_REMISE_ARTICLE_'+@ABBREV_DOCUMENT+'_L=0'
if @ID_DEVISE_SOCIETE=@ID_DEVISE_DOCUMENT
	set @sql=@sql+',PRIX_VENTE_PUBLIC_'+@ABBREV_DOCUMENT+'_L=A.PRIX_VENTE_PUBLIC_ARTICLE '
if @STATUT_NS is not NULL
	set @sql=@sql+',NUMERO_SERIE_'+@ABBREV_DOCUMENT+'_L=NULL '
set @sql=@sql+',POIDS_ARTICLE_BRUT_'+@ABBREV_DOCUMENT+'_L=A.POIDS_BRUT_KG,POIDS_ARTICLE_NET_'+@ABBREV_DOCUMENT+'_L=A.POIDS_NET_KG'
if @STOCK_BRF=1
	set @sql=@sql+',BRF_'+@ABBREV_DOCUMENT+'_L_ID=NULL,NUMERO_BRF_'+@ABBREV_DOCUMENT+'_L=NULL'
set @sql=@sql+',FODEC_'+@ABBREV_DOCUMENT+'_L=CASE WHEN A.FODEC_'+@VA+'_ARTICLE=1 THEN '+CAST(@FODEC as varchar(50))+ ' ELSE NULL END '
set @sql=@sql+',TPE_'+@ABBREV_DOCUMENT+'_L=CASE WHEN A.TPE_'+@VA+'_ARTICLE=1 THEN '+CAST(@TPE as varchar(50))+ ' ELSE NULL END '
set @sql=@sql+',TYPE_DROIT_CONSOMMATION_'+@ABBREV_DOCUMENT+'_L=CASE WHEN A.DROIT_CONSOMMATION_'+@VA+'_ARTICLE=1 THEN A.TYPE_DROIT_CONSOMMATION_ARTICLE ELSE NULL END '
set @sql=@sql+',VALEUR_DROIT_CONSOMMATION_'+@ABBREV_DOCUMENT+'_L=CASE WHEN A.DROIT_CONSOMMATION_'+@VA+'_ARTICLE=1 THEN A.VALEUR_DROIT_CONSOMMATION_ARTICLE ELSE NULL END '
if @ID_TAILLE is not NULL and @NOM_TAILLE is not NULL
	Begin
		set @sql=@sql+',TAILLE_'+@ABBREV_DOCUMENT+'_L_ID='+CAST(@ID_TAILLE as varchar(50))
		set @sql=@sql+',NOM_TAILLE_'+@ABBREV_DOCUMENT+'_L='''+@NOM_TAILLE+''''
	End
if @ID_COULEUR is not NULL and @NOM_COULEUR is not NULL
	Begin
		set @sql=@sql+',COULEUR_'+@ABBREV_DOCUMENT+'_L_ID='+CAST(@ID_COULEUR as varchar(50))
		set @sql=@sql+',NOM_COULEUR_'+@ABBREV_DOCUMENT+'_L='''+@NOM_COULEUR+''''
	End
set @sql=@sql+' from '+@TABLE_ARTICLE+' A Where A.ID_ARTICLE='+CAST(@ID_ARTICLE as varchar(50))+' and ID_'+@ABBREV_DOCUMENT+'_L='+CAST(@ID_DOCUMENT_LIGNE as varchar(50))
if @ID_DEVISE_SOCIETE<>@ID_DEVISE_DOCUMENT
	SET @sql=@sql+ ' and A.ID_DEVISE='+CAST(@ID_DEVISE_DOCUMENT as varchar(50))
set @sql=@sql+';select @n=@@ROWCOUNT'
execute sp_executesql @sql,N'@n int output',@n output
if @ENVOI_RESULTAT=1
	select @n
else
	set @RESULTAT=@N
END TRY
BEGIN CATCH
	if @TRANSACT=1 ROLLBACK TRANSACTION
	insert SQL_ERREUR (QUERY) values (@SQL)
	if @RESULTAT=1
		select 0,ERROR_NUMBER()
	else
		set @RESULTAT=@N		
	RETURN
END CATCH;
if @TRANSACT=1 Commit Transaction
END
GO

-----------------------------------------------------------------------------------

ALTER procedure [dbo].[PRC_GET_CODE_ARTICLE_ID] @CODE_ARTICLE varchar(50),@ID_SOCIETE numeric(18,0)
as
declare @sql nvarchar(MAX)
declare @ID_ARTICLE numeric(18,0)
declare @BLOQUE int
declare @N int
declare @TABLE varchar(50)


set @sql='select @N=ISNULL(count(1),0) from VUE_ARTICLE_PROPRIETE ' 
+' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
+' and CODE_ARTICLE like ''%'+@CODE_ARTICLE+'%'' '
execute sp_executesql @sql,N'@N int output',@N output

if @N=0
	select 0 as RESULTAT,0 as ID_ARTICLE,0 as BLOQUE_ARTICLE
Else
	if @N=1
		Begin
			set @sql='select CASE WHEN BLOQUE_ARTICLE=1 THEN -1 ELSE 1 END as RESULTAT,CASE WHEN BLOQUE_ARTICLE=1 THEN 0 ELSE ID_ARTICLE END as ID_ARTICLE,BLOQUE_ARTICLE from ARTICLE '
			+' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
			+' and CODE_ARTICLE like ''%'+@CODE_ARTICLE+'%'' '
			execute sp_executesql @sql,N'@N int output',@N output
		End
	else
		Begin
			set @sql='select @N=ISNULL(count(1),0) from VUE_ARTICLE_PROPRIETE ' 
			+' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
			+' and CODE_ARTICLE like ''%'+@CODE_ARTICLE+'%'' and BLOQUE_ARTICLE=0'
			execute sp_executesql @sql,N'@N int output',@N output
			if @N=0
				select -1 as RESULTAT,0 as ID_ARTICLE,0 as BLOQUE_ARTICLE
			else
				select -2 as RESULTAT,0 as ID_ARTICLE,0 as BLOQUE_ARTICLE
		End
GO
-----------------------------------------------------------------------------


ALTER procedure [dbo].[PRC_GET_LIBELLE_ARTICLE_ID] @LIBELLE_ARTICLE nvarchar(MAX),@ID_SOCIETE numeric(18,0)
as
declare @sql nvarchar(MAX)
declare @ID_ARTICLE numeric(18,0)
declare @BLOQUE int
declare @N int
declare @TABLE varchar(50)

set @sql='select @N=ISNULL(count(1),0) from VUE_ARTICLE_PROPRIETE ' 
+' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
+' and LIBELLE_ARTICLE like N''%'+@LIBELLE_ARTICLE+'%'' '
execute sp_executesql @sql,N'@N int output',@N output

if @N=0
	select 0 as RESULTAT,0 as ID_ARTICLE
Else
	if @N=1
		Begin
			set @sql='select CASE WHEN BLOQUE_ARTICLE=1 THEN -1 ELSE 1 END as RESULTAT,CASE WHEN BLOQUE_ARTICLE=1 THEN 0 ELSE ID_ARTICLE END as ID_ARTICLE from ARTICLE ' 
			+' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
			+' and LIBELLE_ARTICLE like N''%'+@LIBELLE_ARTICLE+'%'''
			execute sp_executesql @sql,N'@N int output',@N output
		End
	else
		Begin
			set @sql='select @N=ISNULL(count(1),0) from VUE_ARTICLE_PROPRIETE '
			+' where SOCIETE_ID='+CAST(@ID_SOCIETE as varchar(50))
			+' and LIBELLE_ARTICLE like N''%'+@LIBELLE_ARTICLE+'%'' and BLOQUE_ARTICLE=0'
			execute sp_executesql @sql,N'@N int output',@N output

			if @N=0
				select -1 as RESULTAT,0 as ID_ARTICLE
			else
				select -2 as RESULTAT,0 as ID_ARTICLE
		End
GO

------------------------------------------------------------------------------------

ALTER PROCEDURE [dbo].[PRC_MULTI_SELECTION_ARTICLE] 
@ID_TD numeric(18,0),
@ID_DOCUMENT numeric(18,0),
@ID_MULTIPLE nvarchar(MAX),
@ID_TAILLE nvarchar(MAX),
@ID_COULEUR nvarchar(MAX)

as
declare @sql nvarchar(MAX)
declare @n int
declare @TABLE_DOCUMENT varchar(100)
declare @TABLE_DOCUMENT_LIGNE varchar(100)
declare @ABBREV_DOCUMENT varchar(10)
declare @RESULTAT int
declare @ID_SUIV nvarchar(MAX)
declare @ID_SUIV_TAILLE nvarchar(MAX)
declare @ID_SUIV_COULEUR nvarchar(MAX)
declare @ID_DOCUMENT_LIGNE numeric(18,0)
declare @ID_T numeric(18,0)
declare @ID_C numeric(18,0)

SET DATEFORMAT dmy

select @TABLE_DOCUMENT=TABLE_TD,@ABBREV_DOCUMENT=ABBREVIATION_TD,@TABLE_DOCUMENT_LIGNE=TABLE_LIGNE_TD from TYPE_DOCUMENT where ID_TD=@ID_TD

BEGIN TRANSACTION

BEGIN TRY

WHILE (@ID_MULTIPLE<>'' and CHARINDEX(';', @ID_MULTIPLE)>0 )
Begin
	set @ID_SUIV=substring(@ID_MULTIPLE,1,CHARINDEX(';', @ID_MULTIPLE)-1)
	set @ID_MULTIPLE=substring(@ID_MULTIPLE,CHARINDEX(';', @ID_MULTIPLE)+1,len(@ID_MULTIPLE))
	set @ID_SUIV_TAILLE=substring(@ID_TAILLE,1,CHARINDEX(';', @ID_TAILLE)-1)
	set @ID_TAILLE=substring(@ID_TAILLE,CHARINDEX(';', @ID_TAILLE)+1,len(@ID_TAILLE))
	set @ID_SUIV_COULEUR=substring(@ID_COULEUR,1,CHARINDEX(';', @ID_COULEUR)-1)
	set @ID_COULEUR=substring(@ID_COULEUR,CHARINDEX(';', @ID_COULEUR)+1,len(@ID_COULEUR))
	set @ID_T=CASE WHEN @ID_SUIV_TAILLE='0' THEN NULL ELSE CAST(@ID_SUIV_TAILLE as numeric(18,0)) END
	set @ID_C=CASE WHEN @ID_SUIV_COULEUR='' THEN NULL ELSE CAST(@ID_SUIV_COULEUR as numeric(18,0)) END
	EXEC [PRC_INSERER_DOCUMENT_LIGNE] @ID_TD,@ID_DOCUMENT,0,0,@RESULTAT output,@ID_DOCUMENT_LIGNE output
	if @RESULTAT<0
		Begin
			ROLLBACK TRANSACTION
			insert SQL_ERREUR (QUERY) values (@sql)
			select -99 as RESULTAT,ERROR_NUMBER() 
			RETURN
		End
	EXEC [PRC_MAJ_DOCUMENT_LIGNE_ARTICLE] @ID_TD,@ID_DOCUMENT,@ID_DOCUMENT_LIGNE,@ID_SUIV,@ID_T,@ID_C,0,0,@RESULTAT output
	if @RESULTAT<0
		Begin
			ROLLBACK TRANSACTION
			insert SQL_ERREUR (QUERY) values (@sql)
			select -99 as RESULTAT,ERROR_NUMBER() 
			RETURN
		End

End

set @ID_T=CASE WHEN @ID_TAILLE='' THEN NULL ELSE CAST(@ID_TAILLE as numeric(18,0)) END
set @ID_C=CASE WHEN @ID_COULEUR='' THEN NULL ELSE CAST(@ID_COULEUR as numeric(18,0)) END

EXEC [PRC_INSERER_DOCUMENT_LIGNE] @ID_TD,@ID_DOCUMENT,0,0,@RESULTAT output,@ID_DOCUMENT_LIGNE output
if @RESULTAT<0
	Begin
		ROLLBACK TRANSACTION
		insert SQL_ERREUR (QUERY) values (@sql)
		select -99 as RESULTAT,ERROR_NUMBER() 
		RETURN
	End
EXEC [PRC_MAJ_DOCUMENT_LIGNE_ARTICLE] @ID_TD,@ID_DOCUMENT,@ID_DOCUMENT_LIGNE,@ID_MULTIPLE,@ID_T,@ID_C,0,0,@RESULTAT output
if @RESULTAT<0
	Begin
		ROLLBACK TRANSACTION
		insert SQL_ERREUR (QUERY) values (@sql)
		select -99 as RESULTAT,ERROR_NUMBER() 
		RETURN
	End

select 1 as RESULTAT

END TRY

BEGIN CATCH  
	ROLLBACK TRANSACTION
	insert SQL_ERREUR (QUERY) values (@sql)
	select -99 as RESULTAT,ERROR_NUMBER() 
	RETURN
END CATCH;  

COMMIT TRANSACTION

GO

--------------------------------------------------------------------
--LA TAILLE ET COULEUR DANS LA PAGE NUMERO DE SERIE
insert CONTROLE  (ID_CTRL,PAGE_ID,ID_DESIGN_CTRL,VALEUR_DEFAUT_CTRL,LISTE_DDL,VALEUR_VIDE_CTRL,CHAMPS_CALCULE_CTRL,MODIFIABLE_INSERT_CTRL,MODIFIABLE_UPDATE_CTRL,CHAMPS_CACHE_CTRL,MONNAIE_CTRL,TRONQUER_ZERO_CTRL,CHAMPS_CTRL) values (997,'63','C10',NULL,NULL,NULL,'0','0','0','0','0','0','NOM_TAILLE')
insert CONTROLE  (ID_CTRL,PAGE_ID,ID_DESIGN_CTRL,VALEUR_DEFAUT_CTRL,LISTE_DDL,VALEUR_VIDE_CTRL,CHAMPS_CALCULE_CTRL,MODIFIABLE_INSERT_CTRL,MODIFIABLE_UPDATE_CTRL,CHAMPS_CACHE_CTRL,MONNAIE_CTRL,TRONQUER_ZERO_CTRL,CHAMPS_CTRL) values (998,'63','C11',NULL,NULL,NULL,'0','0','0','0','0','0','NOM_COULEUR')

---------------------------------------------------------------
